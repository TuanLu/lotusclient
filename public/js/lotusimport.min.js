!function(e){function t(t){for(var s,i,l=t[0],o=t[1],d=t[2],h=0,u=[];h<l.length;h++)i=l[h],r[i]&&u.push(r[i][0]),r[i]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);for(c&&c(t);u.length;)u.shift()();return n.push.apply(n,d||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],s=!0,l=1;l<a.length;l++){var o=a[l];0!==r[o]&&(s=!1)}s&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var s={},r={1:0},n=[];function i(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=s,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window.webpackJsonp=window.webpackJsonp||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var c=o;n.push([642,0]),a()}({418:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(65),i=a.n(n),l=a(72);var o={START_APP:"START_APP",UPDATE_STATE_DATA:"UPDATE_STATE_DATA"};const d=e=>({type:o.UPDATE_STATE_DATA,updateData:e});var c=Object(l.b)(e=>({mainState:e.main.present}))(class extends s.Component{constructor(e){super(e),this.showReportBy=this.showReportBy.bind(this),this.showMenu=this.showMenu.bind(this)}showReportBy(e){this.props.dispatch(d({pageId:e}))}showChartMenu(){let e=this.props.mainState.reportBy;return[{reportBy:"doanh_thu_tong",title:"Doanh thu theo năm"},{reportBy:"theo_mien",title:"Doanh thu theo miền"},{reportBy:"theo_tinh",title:"Doanh thu theo tỉnh",filter:{area:"b",quarter:1}}].map((t,a)=>r.a.createElement("div",{onClick:()=>{window.location.href=ISD_BASE_URL+"?page="+t.reportBy},key:a,className:`menu_item ${e==t.reportBy?"active":""}`},r.a.createElement("div",{className:"info"},t.title)))}showMenu(){let e=this.props.mainState.pageId;return[{pageId:"orders",title:"Quản lý đơn hàng"},{pageId:"stores",title:"Quản lý nhà thuốc"},{pageId:"plan",title:"Quản lý kế hoạch"}].map((t,a)=>r.a.createElement("div",{onClick:()=>{let e={pageId:t.pageId};this.props.dispatch(d(e))},key:a,className:`menu_item ${e==t.pageId?"active":""}`},r.a.createElement("div",{className:"info"},t.title)))}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"main_menu",style:{marginTop:33}},this.showChartMenu(),this.showMenu()))}}),h=a(12),u=a(52),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var p=class extends r.a.Component{constructor(e){super(e),this.handleChange=((e,{name:t,value:a})=>this.setState({[t]:a})),this.handleSubmit=(()=>{if(this.props.onSubmit){var e=this.state;let t=e.store_id,a=e.name,s=e.address,r=e.owner,n=e.phone,i=e.district_id,l=e.area_id,o=e.province_id;if(""==s||"0"==i||""==i)return alert("Hãy nhập đầy đủ thông tin ở các trường có dấu (*)"),!1;let d=this.state.districts.filter(e=>e.code==this.state.district_id);this.props.onSubmit({store_id:t,name:a,address:s,phone:n,owner:r,district_id:i,area_id:l,province_id:o,huyen:d.length?d[0].name:""})}}),this.state={areas:[{key:"empty",value:"",text:"Chọn miền"},{key:"b",value:"b",text:"Miền Bắc"},{key:"t",value:"t",text:"Miền Trung"},{key:"n",value:"n",text:"Miền Nam"}],provinces:[],districts:[],area_id:"",province_id:"",district_id:""}}componentDidMount(){fetch(ISD_BASE_URL+"storeslocation").then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.provinces.length&&e.data.district.length&&this.setState({provinces:e.data.provinces,districts:e.data.district})}).catch(e=>{console.log("parsing failed",e)})}getPrivinceOptions(){if(this.state.provinces.length){let e=this.state.provinces;return this.state.area_id&&(e=this.state.provinces.filter(e=>e.area_code==this.state.area_id)),e.map(e=>({key:e.code,value:e.code,text:e.name}))}return[{key:"empty",value:"",text:"Chọn miền trước"}]}getDistrictOptions(){if(this.state.districts.length){let e=this.state.districts;return this.state.province_id&&(e=this.state.districts.filter(e=>e.parent_code==this.state.province_id)),e.map(e=>({key:e.code,value:e.code,text:e.name}))}return[{key:"empty",value:"",text:"Chọn tỉnh trước"}]}static getDerivedStateFromProps(e,t){return m({},e.data)}render(){var e=this.state;let t=e.store_id,a=e.name,s=e.address,n=e.phone,i=e.owner,l=e.district_id,o=e.area_id,d=e.province_id;return r.a.createElement(h.h,{inverted:!0,color:"teal",style:{textAlign:"left",width:600,position:"fixed",top:50,right:38,zIndex:1e3}},r.a.createElement("h2",{style:{textAlign:"center",textTransform:"uppercase"}},"Thông tin nhà thuốc"),r.a.createElement(h.c,{onSubmit:this.handleSubmit},r.a.createElement(h.c.Group,{widths:"equal"},r.a.createElement(h.c.Input,{value:t,onChange:this.handleChange,readOnly:!0,name:"store_id",label:"Mã nhà thuốc",placeholder:"Tự động sinh mã"}),r.a.createElement(h.c.Input,{value:a,onChange:this.handleChange,name:"name",label:"Tên nhà thuốc",placeholder:"Tên nhà thuốc"})),r.a.createElement(h.c.TextArea,{value:s,onChange:this.handleChange,required:!0,name:"address",label:"Địa chỉ",placeholder:"Địa chỉ"}),r.a.createElement(h.c.Group,{widths:"equal"},r.a.createElement(h.c.Input,{value:n||"",onChange:this.handleChange,name:"phone",label:"Điện thoại",placeholder:"Điện thoại"}),r.a.createElement(h.c.Input,{value:i||"",onChange:this.handleChange,name:"owner",label:"Chủ hiệu thuốc",placeholder:"Chủ hiệu thuốc"})),r.a.createElement(h.c.Group,{widths:"equal"},r.a.createElement(h.c.Select,{compact:!0,name:"area_id",options:this.state.areas,value:o,label:"Miền",onChange:this.handleChange}),r.a.createElement(h.c.Select,{compact:!0,name:"province_id",search:!0,value:d,options:this.getPrivinceOptions(),onChange:this.handleChange,label:"Tỉnh/TP"}),r.a.createElement(h.c.Select,{required:!0,search:!0,options:this.getDistrictOptions(),onChange:this.handleChange,compact:!0,value:l,name:"district_id",label:"Quận/Huyện"})),r.a.createElement(h.a,{primary:!0},"Lưu nhà thuốc"),r.a.createElement(h.a,{type:"button",color:"orange",onClick:e=>{this.props.onCancel(e)}},"Huỷ")))}},g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};class v extends r.a.Component{constructor(e){super(e),this.handleRowClick=this.handleRowClick.bind(this),this.state={data:this.props.data||[],currentStore:g({},this.getResetDataField()),showForm:!1}}getResetDataField(){return{store_id:"",name:"",address:"",phone:"",owner:"",district_id:""}}handleRowClick(e){this.setState({currentStore:e,showForm:!0})}updateDataToServer(e){fetch(ISD_BASE_URL+"updatestore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(e.data){let t;t=e.newRecord?this.state.data.concat(e.data):this.state.data.map(t=>t.store_id==e.data.store_id?g({},t,e.data):t),this.setState({data:t,showForm:!1,currentStore:g({},this.getResetDataField())})}else this.setState({showForm:!1})}).catch(e=>{console.log("parsing failed",e)})}deleteStore(e){fetch(ISD_BASE_URL+`deletestore/${e}`,{method:"GET"}).then(e=>e.json()).then(e=>{if(e.data){let t=this.state.data.filter(t=>t.store_id!=e.data);this.setState({data:t})}}).catch(e=>{console.log("parsing failed",e)})}customFilter(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}customFilterDistrict(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}render(){var e=this.state;const t=e.data,a=e.currentStore;return r.a.createElement("div",null,r.a.createElement("div",{className:"ui grid equal width"},r.a.createElement("div",{className:"column left aligned"},r.a.createElement("h2",{style:{textTransform:"uppercase"}},"Danh sách các nhà thuốc")),r.a.createElement("div",{className:"column right aligned"},r.a.createElement("button",{onClick:()=>{this.setState({showForm:!0,currentStore:g({},this.getResetDataField())})},type:"button",className:"ui button primary"},"Thêm hiệu thuốc"))),this.state.showForm?r.a.createElement(p,{data:a,onSubmit:e=>{this.updateDataToServer(e)},onCancel:e=>{this.setState({showForm:!1,currentStore:g({},this.getResetDataField())})}}):null,r.a.createElement(u.a,{columns:[{Header:"Thông tin nhà thuốc",columns:[{Header:"Mã KH",accessor:"store_id",maxWidth:100},{Header:"Tên nhà thuốc",accessor:"name",filterMethod:this.customFilter},{Header:"Địa chỉ",accessor:"address",filterMethod:this.customFilter},{Header:"Điện thoại",accessor:"phone"},{Header:"Chủ",accessor:"owner"},{Header:"Mã Quận/Huyện (*)",accessor:"huyen",filterMethod:this.customFilterDistrict,Cell:e=>r.a.createElement("div",{className:`${0==e.original.district_id?"ui warning message":""}`,style:{padding:2}},0!=e.original.district_id?e.original.huyen:"Chọn mã quận/huyện")}]},{Header:"Actions",columns:[{Header:"Sửa | Xoá",accessor:"store_id",filterable:!1,Cell:e=>r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:()=>{this.handleRowClick(e.original)},className:"ui icon button teal tiny",role:"button"},r.a.createElement("i",{"aria-hidden":"true",className:"edit icon"})),r.a.createElement("button",{onClick:()=>{if(!confirm("Bạn có thật sự muốn xoá nhà thuốc : "+e.value))return!1;this.deleteStore(e.value)},className:"ui icon button red tiny",role:"button"},r.a.createElement("i",{"aria-hidden":"true",className:"remove icon"})))}]}],data:t,filterable:!0,defaultPageSize:20,className:"-striped -highlight"}))}}class f extends r.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.state={dataUpToDate:null,url:this.props.url,stores:[]}}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({dataUpToDate:!0,stores:e.data})}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){return r.a.createElement("div",{className:"ui segment"},this.state.dataUpToDate?r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{data:this.state.stores})):r.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var E=a(5),b=a.n(E),S=a(128),y=a.n(S),_=a(37),j=a.n(_),D=a(73),w=a.n(D);class C extends s.Component{constructor(e){super(e),this.resetComponent=(()=>this.setState({isLoading:!1,results:[],value:""})),this.handleResultSelect=((e,{result:t})=>{this.props.onResultSelect&&this.props.onResultSelect(t),this.setState({value:t.store_id})}),this.handleSearchChange=((e,{value:t})=>{this.setState({isLoading:!0,value:t}),setTimeout(()=>{if(this.state.value.length<1)return this.resetComponent();const e=new RegExp(w()(this.state.value),"i");this.setState({isLoading:!1,results:j()(this.props.source,t=>e.test(t.title))})},300)}),this.state={isLoading:!1,results:[],value:""}}static getDerivedStateFromProps(e,t){return e.storeId==t.value||{value:e.storeId}}render(){var e=this.state;const t=e.isLoading,a=e.value,s=e.results;return r.a.createElement(h.g,{aligned:"right",loading:t,onResultSelect:this.handleResultSelect,onSearchChange:y()(this.handleSearchChange,500,{leading:!0}),results:s,value:a,resultRenderer:({title:e,description:t,store_id:a})=>r.a.createElement("div",null,`${e}`),fluid:!0,source:this.props.source})}}class N extends s.Component{constructor(e){super(e),this.resetComponent=(()=>this.setState({isLoading:!1,results:[],value:""})),this.handleResultSelect=((e,{result:t})=>{this.props.onResultSelect&&this.props.onResultSelect(t),this.setState({value:t.store_id})}),this.handleSearchChange=((e,{value:t})=>{this.setState({isLoading:!0,value:t}),setTimeout(()=>{if(this.state.value.length<1)return this.resetComponent();const e=new RegExp(w()(this.state.value),"i");this.setState({isLoading:!1,results:j()(this.props.source,t=>e.test(t.title))})},300)}),this.state={isLoading:!1,results:[],value:""}}static getDerivedStateFromProps(e,t){return e.districtId==t.value||{value:e.districtId}}render(){var e=this.state;const t=e.isLoading,a=e.value,s=e.results;return r.a.createElement(h.g,{aligned:"right",loading:t,onResultSelect:this.handleResultSelect,onSearchChange:y()(this.handleSearchChange,500,{leading:!0}),results:s,value:a,resultRenderer:({title:e,description:t,district_id:a})=>r.a.createElement("div",null,`${e}`),fluid:!0,source:this.props.source})}}class T extends r.a.Component{constructor(e){super(e),this.upload=this.upload.bind(this),this.chooseFile=this.chooseFile.bind(this),this.state={progressing:0,upload:!1,error:!1,errorMessage:this.props.errorMessage||"Xin lỗi! file chưa được upload thành công!"}}upload(e,t){let a=this;var s=new XMLHttpRequest;s.open("POST",t,!0),this.setState({upload:!0}),s.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;a.setState({progressing:parseInt(t)})}},s.onload=function(){if(200==this.status&&(a.setState({upload:!1,progressing:0,error:!1}),a.props.done)){a.props.done(this.response);let e=JSON.parse(this.response);"error"==e.status&&a.setState({error:!0,errorMessage:e.message||this.state.errorMessage})}},s.onerror=function(){a.setState({upload:!0,progressing:1,error:!0})},s.send(e)}chooseFile(e){var t=e.target.files,a=new FormData;a.append("filename",t[0]),this.upload(a,this.props.url)}render(){return r.a.createElement("div",{className:"file-upload",style:this.props.style},r.a.createElement("input",{type:"file",onChange:e=>this.chooseFile(e)}),this.state.upload?r.a.createElement(h.f,{style:{marginTop:10},percent:this.state.progressing,color:"olive",progress:!0,indicating:!0}):null,this.state.error?r.a.createElement("div",{className:"ui message warning"},this.state.errorMessage):null)}}var O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var x=class extends r.a.Component{constructor(e){super(e),this.renderEditableNumber=this.renderEditableNumber.bind(this),this.renderEditableText=this.renderEditableText.bind(this),this.renderEditableArea=this.renderEditableArea.bind(this),this.renderEditable=this.renderEditable.bind(this),this.updateRowData=this.updateRowData.bind(this),this.fetchData=this.fetchData.bind(this),this.state={preOrderData:[],stores:[],products:[],deliveries:[],productIds:[],storeIds:[],deliveryIds:[],districtIds:[],districts:[],units:this.getUnitOptions(),unitIds:["Hộp","Vỉ","Lọ"]}}getUnitOptions(){return[{key:"Hộp",value:"Hộp",text:"Hộp"},{key:"Vỉ",value:"Vỉ",text:"Vỉ"},{key:"Lọ",value:"Lọ",text:"Lọ"}]}getAreaOptions(){return[{key:"Bắc",value:"Bắc",text:"Bắc"},{key:"Trung",value:"Trung",text:"Trung"},{key:"Nam",value:"Nam",text:"Nam"}]}renderEditableNumber(e){return r.a.createElement(h.d,{error:""==e.value,type:"number",min:0,fluid:!0,defaultValue:e.value,onBlur:t=>{this.updateRowData(e,t.target.value)}})}renderEditable(e){return r.a.createElement("div",{className:"editable-input",style:{backgroundColor:"#fafafa"},contentEditable:!0,suppressContentEditableWarning:!0,onBlur:t=>{const a=[...this.state.preOrderData];a[e.index][e.column.id]=t.target.innerHTML,this.setState({preOrderData:a})},dangerouslySetInnerHTML:{__html:this.state.preOrderData[e.index][e.column.id]}})}renderEditableText(e){return r.a.createElement(h.d,{type:"text",error:""==e.value,required:!0,fluid:!0,defaultValue:this.state.preOrderData[e.index][e.column.id],onBlur:t=>{this.updateRowData(e,t.target.value)}})}renderEditableArea(e){return r.a.createElement(h.i,{required:!0,defaultValue:e.value,onBlur:t=>{this.updateRowData(e,t.target.value)}})}updateRowData(e,t){const a=[...this.state.preOrderData];a[e.index][e.column.id]=t,this.setState({preOrderData:a})}validDataBeforeSave(){let e=this.state.preOrderData,t=!0;if(e&&e.length)for(let a=0;a<e.length;a++){if(-1==this.state.productIds.indexOf(e[a].product_id)){alert(`Mã sản phẩm [${e[a].product_id}] chưa tồn tại trong hệ thống! Bạn hãy thêm sản phẩm mới hoặc chọn lại mã sản phẩm đúng!`),t=!1;break}if(""==e[a].date||!e[a].date){alert("Ngày mua không được để trống. Xin hãy nhập theo format ngay/thang/nam: VD: 24/05/2018"),t=!1;break}}return t}updateDataToServer(){if(!this.validDataBeforeSave())return!1;let e=this.state.preOrderData;fetch(ISD_BASE_URL+"addorders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.data?(alert(`Đã cập nhật ${e.data} hoá đơn vào cơ sở dữ liệu!`),this.setState({preOrderData:[]}),this.props.onAddOrderComplete&&this.props.onAddOrderComplete()):alert("Dữ liệu chưa được lưu vào hệ thống. Xin kiểm tra lại")}).catch(e=>{console.log("parsing failed",e)})}static getDerivedStateFromProps(e,t){if(e.data&&e.data.order_id){let t=O({},e.data,{date:b()(e.data.date).format("DD/MM/YYYY")});return{order_id:t.order_id,preOrderData:[t],dataUpToDate:null}}return!0}componentDidUpdate(){null===this.state.dataUpToDate&&this.state.order_id&&this.fetchData(()=>{let e=[...this.state.preOrderData],t=this.state.stores.filter(t=>t.store_id==e[0].store_id),a=this.state.districts.filter(e=>e.district_id==t[0].district_id);e[0]=O({},e[0],t[0],{district_name:a[0].huyen}),this.setState({dataUpToDate:!0,preOrderData:e})})}fetchData(e){return fetch(ISD_BASE_URL+"importOrderData").then(e=>e.json()).then(t=>{if(t.status&&"error"==t.status)return console.warn(t.message),!1;if(t.data&&t.data.stores.length&&t.data.products.length){let a=[],s=t.data.products.map(e=>(a.push(e.product_id),{key:e.product_id,value:e.product_id,text:e.name})),r=[],n=t.data.deliveries.map(e=>(r.push(e.delivery_id),{key:e.delivery_id,value:e.delivery_id,text:e.name})),i=[],l=t.data.stores.map(e=>(i.push(e.store_id),e)),o=[],d=t.data.districts.map(e=>(o.push(e.district_id),e));this.setState({stores:l,products:s,deliveries:n,districts:d,districtIds:o,productIds:a,storeIds:i,deliveryIds:r}),e&&e()}}).catch(e=>{console.log("parsing failed",e)}),!1}componentDidMount(){this.fetchData()}getDefaultItemField(){return{store_id:"",name:"",address:"",product_id:"",delivery_id:"",date:"",qty:"",price:"",unit:"",district_id:"",district_name:"",name_address:"",tdv:""}}addNewOrder(){this.setState({preOrderData:this.state.preOrderData.concat(this.getDefaultItemField())})}render(){let e=this.state.preOrderData;return r.a.createElement("div",{className:"order-add-form",style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"98%",background:"#fff",zIndex:1e3}},r.a.createElement("div",{className:"ui grid equal width"},r.a.createElement("div",{className:"column left aligned"},r.a.createElement("h2",{style:{textTransform:"uppercase"}},"Form nhập đơn hàng")),r.a.createElement("div",{className:"column right aligned"},r.a.createElement("div",{className:"upload-btn primary",style:{position:"relative"}},r.a.createElement("button",{style:{position:"absolute",top:0,left:0,pointerEvents:"none",marginTop:10,zIndex:1,width:"100%"},type:"button",className:"fake-btn button ui primary"},"Import từ file excel"),r.a.createElement(T,{url:ISD_BASE_URL+"upload",done:e=>{let t=JSON.parse(e);"success"==t.status&&t.data&&this.setState({preOrderData:t.data})}}))),r.a.createElement("div",{className:"column right aligned"},r.a.createElement("button",{style:{marginTop:10},onClick:()=>{this.addNewOrder()},type:"button",className:"ui button primary"},"Thêm hoá đơn"),r.a.createElement("button",{style:{marginTop:10},onClick:()=>{this.updateDataToServer()},type:"button",className:"ui button teal"},"Lưu hoá đơn"),r.a.createElement("button",{style:{marginTop:10},onClick:()=>{this.setState({preOrderData:[]}),this.props.onCancel()},type:"button",className:"ui button orange"},"Huỷ"))),r.a.createElement(u.a,{columns:[{Header:"Thông tin nhà thuốc",columns:[{Header:"Tìm nhà thuốc",accessor:"store_id",minWidth:200,Cell:e=>r.a.createElement("div",{style:{position:"relative"},className:""!=e.value?"store-exitst":""},""==e.value?r.a.createElement("label",{className:"ui teal floating left label tiny"},"Mới"):null,r.a.createElement(C,{onResultSelect:t=>{let a=[...this.state.preOrderData];if(a[e.index][e.column.id]=t.store_id,a[e.index].district_id=t.district_id,0!=t.district_id){let s=this.state.districts.filter(e=>e.district_id==t.district_id);s.length&&(a[e.index].district_name=s[0].huyen)}else a[e.index].district_id="",a[e.index].district_name="";a[e.index].address=t.address,a[e.index].name=t.name,this.setState({preOrderData:a})},storeId:-1==this.state.storeIds.indexOf(e.value)?"":e.value,source:this.state.stores}))},{Header:"Tên nhà thuốc",accessor:"name",minWidth:200,Cell:this.renderEditable},{Header:"Địa chỉ (*)",accessor:"address",minWidth:300,Cell:this.renderEditable},{Header:"Quận/Huyện/TP (*)",accessor:"district_name",minWidth:200,Cell:e=>r.a.createElement("div",{className:e.value?"":"store-item error"},e.value?r.a.createElement("div",null,r.a.createElement("span",null,e.value),r.a.createElement("button",{style:{float:"right"},onClick:()=>{const t=[...this.state.preOrderData];t[e.index][e.column.id]="",t[e.index].district_id="",this.setState({preOrderData:t})},className:"ui button icon basic compact circular tiny"},r.a.createElement("i",{className:"icon ui search"}))):r.a.createElement(N,{onResultSelect:t=>{const a=[...this.state.preOrderData];a[e.index][e.column.id]=t.huyen,a[e.index].district_id=t.district_id,this.setState({preOrderData:a})},source:this.state.districts}))}]},{Header:"Thông tin đơn hàng",columns:[{Header:"Mã sản phẩm",accessor:"product_id",minWidth:170,Cell:e=>r.a.createElement(r.a.Fragment,null,r.a.createElement(h.b,{fluid:!0,selection:!0,style:{zIndex:100},search:!0,options:this.state.products,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}}))},{Header:"Ngày bán",accessor:"date",minWidth:150,Cell:this.renderEditable},{Header:"Số lượng",accessor:"qty",Cell:this.renderEditable},{Header:"Đơn giá",accessor:"price",Cell:this.renderEditable},{Header:"Đơn vị",accessor:"unit",Cell:e=>r.a.createElement(h.b,{error:-1==this.state.unitIds.indexOf(e.value),selection:!0,fluid:!0,compact:!0,style:{zIndex:0},options:this.state.units,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}})},{Header:"Mã NPP",accessor:"delivery_id",minWidth:100,Cell:e=>r.a.createElement(h.b,{error:-1==this.state.deliveryIds.indexOf(e.value),selection:!0,fluid:!0,style:{zIndex:0},search:!0,options:this.state.deliveries,onChange:(t,a)=>{this.updateRowData(e,a.value)},value:e.value})},{Header:"Mã TDV",accessor:"tdv",minWidth:100,Cell:this.renderEditable},{Header:"Action",accessor:"store_id",filterable:!1,minWidth:100,Cell:e=>r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:()=>{let t=e.row.name+" "+e.row.address;if(!confirm("Bạn có thật sự muốn xoá bản ghi : "+t))return!1;const a=this.state.preOrderData.filter((t,a)=>e.index!=a);this.setState({preOrderData:a})},className:"ui icon button red",role:"button"},r.a.createElement("i",{"aria-hidden":"true",className:"remove icon"})))}]}],filterable:!0,data:e,defaultPageSize:20,className:"-striped -highlight",style:{height:"500px"}}))}},k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};class R extends r.a.Component{constructor(e){super(e),this.handleRowClick=this.handleRowClick.bind(this),this.refreshOrderData=this.refreshOrderData.bind(this),this.state={data:this.props.data||[],currentOrder:k({},this.getResetDataField()),showForm:!1}}getResetDataField(){return{order_id:"",name:"",address:"",phone:"",owner:"",district_id:""}}handleRowClick(e){this.setState({currentOrder:e,showForm:!0})}updateDataToServer(e){fetch(ISD_BASE_URL+"updatestore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(e.data){let t;t=e.newRecord?this.state.data.concat(e.data):this.state.data.map(t=>t.order_id==e.data.order_id?k({},t,e.data):t),this.setState({data:t,showForm:!1,currentOrder:k({},this.getResetDataField())})}else this.setState({showForm:!1})}).catch(e=>{console.log("parsing failed",e)})}deleteOrder(e){fetch(ISD_BASE_URL+`deleteorder/${e}`,{method:"get"}).then(e=>e.json()).then(e=>{if(e.data){let t=this.state.data.filter(t=>t.order_id!=e.data);this.setState({data:t,showForm:!1,currentOrder:k({},this.getResetDataField())})}}).catch(e=>{console.log("parsing failed",e)})}customFilter(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}customFilterDistrict(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}refreshOrderData(){fetch(ISD_BASE_URL+"orders").then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({data:e.data})}).catch(e=>{console.log("parsing failed",e)})}render(){var e=this.state;const t=e.data,a=e.currentOrder;return r.a.createElement("div",null,r.a.createElement("div",{className:"ui grid equal width"},r.a.createElement("div",{className:"column left aligned"},r.a.createElement("h2",{style:{textTransform:"uppercase"}},"Danh sách hoá đơn")),r.a.createElement("div",{className:"column right aligned"},r.a.createElement("button",{onClick:()=>{this.setState({showForm:!0,currentOrder:k({},this.getResetDataField())})},type:"button",className:"ui button primary"},"Nhập hoá đơn"))),this.state.showForm?r.a.createElement(x,{data:a,onAddOrderComplete:()=>{this.setState({showForm:!1}),this.refreshOrderData()},onCancel:e=>{this.setState({showForm:!1})}}):null,r.a.createElement(u.a,{columns:[{Header:"Mã hoá đơn",columns:[{Header:"OrderID",accessor:"order_id",maxWidth:100},{Header:"Mã nhà thuốc",accessor:"store_id",maxWidth:100},{Header:"Mã sản phẩm",accessor:"product_id",maxWidth:100},{Header:"Mã NPP",accessor:"delivery_id",maxWidth:100}]},{Header:"Thông tin đơn hàng",columns:[{Header:"Ngày bán",accessor:"date"},{Header:"Số lượng",accessor:"qty"},{Header:"Đơn vị",accessor:"unit"},{Header:"Đơn giá",accessor:"price"},{Header:"TDV",accessor:"tdv"}]},{Header:"Actions",columns:[{Header:"Sửa | Xoá",filterable:!1,accessor:"order_id",Cell:e=>r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:()=>{this.handleRowClick(e.original)},className:"ui icon button teal tiny",role:"button"},r.a.createElement("i",{"aria-hidden":"true",className:"edit icon"})),r.a.createElement("button",{onClick:()=>{if(!confirm("Bạn có thật sự muốn xoá hoá đơn : "+e.value))return!1;this.deleteOrder(e.value)},className:"ui icon button red tiny",role:"button"},r.a.createElement("i",{"aria-hidden":"true",className:"remove icon"})))}]}],data:t,filterable:!0,defaultPageSize:20,className:"-striped -highlight"}))}}var I,A;Object.assign;window.ISD_BASE_URL&&""!=window.ISD_BASE_URL||(window.ISD_BASE_URL=window.location.protocol+"//"+(I=document.location.href,null!=(A=I.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i))&&A.length>2&&"string"==typeof A[2]&&A[2].length>0?A[2]:null)+"/");const F=()=>{let e=sessionStorage.getItem("ISD_TOKEN");if(""!=e&&null!=e)return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e}};class P extends r.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.state={dataUpToDate:null,url:this.props.url,datasource:[]}}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e,{headers:F()}).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({dataUpToDate:!0,datasource:e.data})}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){return r.a.createElement("div",{className:"ui segment"},this.state.dataUpToDate?r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{data:this.state.datasource})):r.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};const L=(e,t)=>Array.from(Array(t-e+1).keys()).map(t=>t+e);class M extends r.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.planColumns=this.planColumns.bind(this),this.renderEditableNumber=this.renderEditableNumber.bind(this),this.updateRowData=this.updateRowData.bind(this),this.addNewPlan=this.addNewPlan.bind(this),this.savePlan=this.savePlan.bind(this),this.state={dataUpToDate:null,url:this.props.url,datasource:[],products:[]}}updateRowData(e,t){const a=[...this.state.datasource];a[e.index][e.column.id]=t,this.setState({datasource:a})}renderEditableNumber(e){return r.a.createElement(h.d,{error:""==e.value,type:"number",min:0,fluid:!0,defaultValue:e.value||0,onChange:t=>{this.updateRowData(e,t.target.value)}})}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;let t={};e.plans&&(t.datasource=e.plans),e.products&&(t.products=e.products.map(e=>({key:e.product_id,value:e.product_id,text:e.name}))),this.setState(H({dataUpToDate:!0},t))}).catch(e=>{console.log("parsing failed",e)})}planColumns(){return L(1,52).map((e,t)=>({Header:`T${e}`,accessor:`w${e}`,maxWidth:100,Cell:this.renderEditableNumber}))}addNewPlan(){let e=H({plan_no:"",year:(new Date).getFullYear(),product_id:""},L(1,52).map(e=>{}));this.setState({datasource:this.state.datasource.concat(e)})}validDataBeforeSave(){let e=(e=>Object.keys(e).filter(t=>e[t]>1))((e=>e.reduce((e,t)=>Object.assign(e,{[t]:(e[t]||0)+1}),{}))(this.state.datasource.map(e=>`${e.year}_${e.product_id}`)));return!e.length||(alert("Có sản phẩm bị trùng kế hoạch: "+e[0]),!1)}savePlan(){if(!this.validDataBeforeSave())return!1;let e=this.state.datasource;fetch(ISD_BASE_URL+"updateplan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.data?alert("Đã cập nhật kế hoạch vào cơ sở dữ liệu!"):alert("Dữ liệu chưa được lưu vào hệ thống. Xin kiểm tra lại")}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){let e=this.state.datasource;return r.a.createElement("div",{className:"ui segment order-add-form"},this.state.dataUpToDate?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ui grid equal width"},r.a.createElement("div",{className:"column left aligned"},r.a.createElement("h2",{style:{textTransform:"uppercase"}},"Kế hoạch theo từng tuần trong năm")),r.a.createElement("div",{className:"column right aligned"},r.a.createElement("button",{onClick:()=>{this.addNewPlan()},type:"button",className:"ui button primary"},"Thêm kế hoạch"),r.a.createElement("button",{onClick:()=>{this.savePlan()},type:"button",className:"ui button teal"},"Lưu thay đổi"))),r.a.createElement(u.a,{getTdProps:(e,t,a,s)=>({onClick:(e,t)=>{t&&t()}}),columns:[{Header:"Thông tin kế hoạch",columns:[{Header:"Năm",accessor:"year",Cell:this.renderEditableNumber},{Header:"Sản phẩm",accessor:"product_id",minWidth:200,Cell:e=>r.a.createElement(h.b,{fluid:!0,selection:!0,style:{zIndex:100},search:!0,options:this.state.products,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}})}]},{Header:"Kế hoạch từng tuần trong năm",columns:this.planColumns()}],data:e,filterable:!0,defaultPageSize:20,className:"-striped -highlight",style:{maxWidth:980}})):r.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var B=class extends r.a.Component{constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this),this.state={userName:"",password:"",loading:!1}}handleSubmit(){if(""==this.state.userName||""==this.state.password)return alert("Tên đăng nhập hoặc mật khẩu trống!"),!1;this.setState({loading:!0}),fetch(ISD_BASE_URL+"token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:this.state.userName,password:this.state.password})}).then(e=>e.json()).then(e=>{e.token?(sessionStorage.setItem("ISD_TOKEN",e.token),this.props.dispatch(d({showLogin:!1,userRoles:e.scopes||[],userInfo:e.userInfo,defaultRouter:e.scopes[0]&&e.scopes[0].path?e.scopes[0].path:""}))):(alert.log(e.message),this.setState({loading:!1}))}).catch(e=>{console(e)})}render(){return r.a.createElement("div",{className:"isd-login-form"},r.a.createElement("div",{className:"login-logo"},r.a.createElement("img",{src:"./images/logo-pharma.png",alt:"Logo"})),r.a.createElement(h.c,{id:"loginForm"},r.a.createElement(h.c.Field,null,r.a.createElement("label",null,"Tên đăng nhập"),r.a.createElement("input",{value:this.state.userName,onChange:e=>{this.setState({userName:e.target.value})},required:!0,placeholder:"Tên đăng nhập"})),r.a.createElement(h.c.Field,null,r.a.createElement("label",null,"Mật khẩu"),r.a.createElement("input",{value:this.state.password,onChange:e=>{this.setState({password:e.target.value})},required:!0,placeholder:"Mật Khẩu",type:"password"})),r.a.createElement(h.a,{loading:this.state.loading,onClick:this.handleSubmit,type:"button",color:"violet"},"Đăng nhập")))}};var U=class extends r.a.Component{showUserName(){let e=this.props.mainState.userInfo;if(e)return e.name||e.username||e.email}render(){return r.a.createElement("div",{className:"admin-user-info"},r.a.createElement("div",{className:"user-info",style:{margin:10}},r.a.createElement("p",null,"Xin chào, "," ",r.a.createElement("b",null,this.showUserName()))),r.a.createElement("button",{onClick:()=>{this.props.dispatch(d({showLogin:!0}))},className:"ui button primary inverted teal"},"Đăng xuất"))}};var z=Object(l.b)(e=>({mainState:e.main.present,uiState:e.ui}))(class extends s.Component{constructor(e){super(e),this.renderManagePage=this.renderManagePage.bind(this)}renderManagePage(){let e=this.props.mainState.pageId;switch(e){case"stores":return r.a.createElement(f,{url:ISD_BASE_URL+"stores"});case"orders":return r.a.createElement(P,{url:ISD_BASE_URL+"orders"});case"plan":return r.a.createElement(M,{url:ISD_BASE_URL+"plan"});default:return r.a.createElement("h1",null,"Render ",e," page")}}componentWillMount(){let e=this.props.mainState;if(e.userInfo)this.props.dispatch(d({defaultRouter:e.defaultRouter}));else{let e=sessionStorage.getItem("ISD_TOKEN");""!=e&&null!=e&&fetch(ISD_BASE_URL+"fetchRoles",{headers:F()}).then(e=>e.json()).then(e=>{e.userInfo?this.props.dispatch(d({showLogin:!1,userRoles:e.scopes,defaultRouter:e.scopes[0]&&e.scopes[0].path?e.scopes[0].path:"",userInfo:e.userInfo})):"error"==e.status&&alert(e.message)}).catch(e=>{console.warn(e)})}}render(){var e=this.props.mainState;return e.pageId,e.showLogin?r.a.createElement(B,{dispatch:this.props.dispatch}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"grid-container"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"header_left"}),r.a.createElement("div",{className:"header_center"},r.a.createElement("h2",null,"QUẢN TRỊ KHÁCH HÀNG")),r.a.createElement("div",{className:"header_right"},r.a.createElement(U,{dispatch:this.props.dispatch,mainState:this.props.mainState}))),r.a.createElement("div",{className:"menu menu_active"},r.a.createElement("a",{href:"#"},r.a.createElement("img",{width:"200",src:"images/logo-pharma.png"})),r.a.createElement(c,null)),r.a.createElement("div",{className:"isd_main"},r.a.createElement("div",{className:"main_content"},r.a.createElement("div",{className:"main_content_left active",page:"main"},r.a.createElement("div",{className:"list_infos"},this.renderManagePage()))))))}}),q=a(138),W=(a(421),a(182)),$=a.n(W),V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};let J,K={pageId:window.ISD_CURRENT_PAGE?window.ISD_CURRENT_PAGE:"orders",showLogin:!0};var X=a(383),G=a.n(X);let Q=[o.UPDATE_STATE_DATA];var Y=Object(q.c)({main:G()((e=K,t)=>{switch(t.type){case o.START_APP:return J=$()(e),J=V({},J,t.defaultProps);case o.UPDATE_STATE_DATA:return J=$()(e),t.updateData&&t.updateData.showLogin&&sessionStorage.setItem("ISD_TOKEN",""),J=V({},J,t.updateData)}return e},{filter:(e,t,a)=>-1!==Q.indexOf(e.type),limit:100})});const Z=Object(q.a)(),ee=Object(q.d)(Y,Z);ee.close=(()=>ee.dispatch(END));var te=ee;const ae=document.getElementById("isd_app");i.a.render(r.a.createElement(l.a,{store:te},r.a.createElement(z,null)),ae)},423:function(e,t,a){var s={"./af":316,"./af.js":316,"./ar":315,"./ar-dz":314,"./ar-dz.js":314,"./ar-kw":313,"./ar-kw.js":313,"./ar-ly":312,"./ar-ly.js":312,"./ar-ma":311,"./ar-ma.js":311,"./ar-sa":310,"./ar-sa.js":310,"./ar-tn":309,"./ar-tn.js":309,"./ar.js":315,"./az":308,"./az.js":308,"./be":307,"./be.js":307,"./bg":306,"./bg.js":306,"./bm":305,"./bm.js":305,"./bn":304,"./bn.js":304,"./bo":303,"./bo.js":303,"./br":302,"./br.js":302,"./bs":301,"./bs.js":301,"./ca":300,"./ca.js":300,"./cs":299,"./cs.js":299,"./cv":298,"./cv.js":298,"./cy":297,"./cy.js":297,"./da":296,"./da.js":296,"./de":295,"./de-at":294,"./de-at.js":294,"./de-ch":293,"./de-ch.js":293,"./de.js":295,"./dv":292,"./dv.js":292,"./el":291,"./el.js":291,"./en-au":290,"./en-au.js":290,"./en-ca":289,"./en-ca.js":289,"./en-gb":288,"./en-gb.js":288,"./en-ie":287,"./en-ie.js":287,"./en-il":286,"./en-il.js":286,"./en-nz":285,"./en-nz.js":285,"./eo":284,"./eo.js":284,"./es":283,"./es-do":282,"./es-do.js":282,"./es-us":281,"./es-us.js":281,"./es.js":283,"./et":280,"./et.js":280,"./eu":279,"./eu.js":279,"./fa":278,"./fa.js":278,"./fi":277,"./fi.js":277,"./fo":276,"./fo.js":276,"./fr":275,"./fr-ca":274,"./fr-ca.js":274,"./fr-ch":273,"./fr-ch.js":273,"./fr.js":275,"./fy":272,"./fy.js":272,"./gd":271,"./gd.js":271,"./gl":270,"./gl.js":270,"./gom-latn":269,"./gom-latn.js":269,"./gu":268,"./gu.js":268,"./he":267,"./he.js":267,"./hi":266,"./hi.js":266,"./hr":265,"./hr.js":265,"./hu":264,"./hu.js":264,"./hy-am":263,"./hy-am.js":263,"./id":262,"./id.js":262,"./is":261,"./is.js":261,"./it":260,"./it.js":260,"./ja":259,"./ja.js":259,"./jv":258,"./jv.js":258,"./ka":257,"./ka.js":257,"./kk":256,"./kk.js":256,"./km":255,"./km.js":255,"./kn":254,"./kn.js":254,"./ko":253,"./ko.js":253,"./ky":252,"./ky.js":252,"./lb":251,"./lb.js":251,"./lo":250,"./lo.js":250,"./lt":249,"./lt.js":249,"./lv":248,"./lv.js":248,"./me":247,"./me.js":247,"./mi":246,"./mi.js":246,"./mk":245,"./mk.js":245,"./ml":244,"./ml.js":244,"./mn":243,"./mn.js":243,"./mr":242,"./mr.js":242,"./ms":241,"./ms-my":240,"./ms-my.js":240,"./ms.js":241,"./mt":239,"./mt.js":239,"./my":238,"./my.js":238,"./nb":237,"./nb.js":237,"./ne":236,"./ne.js":236,"./nl":235,"./nl-be":234,"./nl-be.js":234,"./nl.js":235,"./nn":233,"./nn.js":233,"./pa-in":232,"./pa-in.js":232,"./pl":231,"./pl.js":231,"./pt":230,"./pt-br":229,"./pt-br.js":229,"./pt.js":230,"./ro":228,"./ro.js":228,"./ru":227,"./ru.js":227,"./sd":226,"./sd.js":226,"./se":225,"./se.js":225,"./si":224,"./si.js":224,"./sk":223,"./sk.js":223,"./sl":222,"./sl.js":222,"./sq":221,"./sq.js":221,"./sr":220,"./sr-cyrl":219,"./sr-cyrl.js":219,"./sr.js":220,"./ss":218,"./ss.js":218,"./sv":217,"./sv.js":217,"./sw":216,"./sw.js":216,"./ta":215,"./ta.js":215,"./te":214,"./te.js":214,"./tet":213,"./tet.js":213,"./tg":212,"./tg.js":212,"./th":211,"./th.js":211,"./tl-ph":210,"./tl-ph.js":210,"./tlh":209,"./tlh.js":209,"./tr":208,"./tr.js":208,"./tzl":207,"./tzl.js":207,"./tzm":206,"./tzm-latn":205,"./tzm-latn.js":205,"./tzm.js":206,"./ug-cn":204,"./ug-cn.js":204,"./uk":203,"./uk.js":203,"./ur":202,"./ur.js":202,"./uz":201,"./uz-latn":200,"./uz-latn.js":200,"./uz.js":201,"./vi":199,"./vi.js":199,"./x-pseudo":198,"./x-pseudo.js":198,"./yo":197,"./yo.js":197,"./zh-cn":196,"./zh-cn.js":196,"./zh-hk":195,"./zh-hk.js":195,"./zh-tw":194,"./zh-tw.js":194};function r(e){var t=n(e);return a(t)}function n(e){var t=s[e];if(!(t+1)){var a=new Error('Cannot find module "'+e+'".');throw a.code="MODULE_NOT_FOUND",a}return t}r.keys=function(){return Object.keys(s)},r.resolve=n,e.exports=r,r.id=423},642:function(e,t,a){e.exports=a(418)}});