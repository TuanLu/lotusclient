!function(e){function t(t){for(var r,i,l=t[0],o=t[1],d=t[2],h=0,u=[];h<l.length;h++)i=l[h],s[i]&&u.push(s[i][0]),s[i]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);for(c&&c(t);u.length;)u.shift()();return n.push.apply(n,d||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,l=1;l<a.length;l++){var o=a[l];0!==s[o]&&(r=!1)}r&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var r={},s={1:0},n=[];function i(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=r,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window.webpackJsonp=window.webpackJsonp||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var c=o;n.push([517,0]),a()}({294:function(e,t,a){"use strict";a.r(t);var r=a(0),s=a.n(r),n=a(64),i=a.n(n),l=a(71);var o={START_APP:"START_APP",UPDATE_STATE_DATA:"UPDATE_STATE_DATA"};const d=e=>({type:o.UPDATE_STATE_DATA,updateData:e});var c=Object(l.b)(e=>({mainState:e.main.present}))(class extends r.Component{constructor(e){super(e),this.showReportBy=this.showReportBy.bind(this),this.showMenu=this.showMenu.bind(this)}showReportBy(e){this.props.dispatch(d({pageId:e}))}showChartMenu(){let e=this.props.mainState.reportBy;return[{reportBy:"doanh_thu_tong",title:"Doanh thu theo năm"},{reportBy:"theo_mien",title:"Doanh thu theo miền"},{reportBy:"theo_tinh",title:"Doanh thu theo tỉnh",filter:{area:"b",quarter:1}}].map((t,a)=>s.a.createElement("div",{onClick:()=>{window.location.href=ISD_BASE_URL+"?page="+t.reportBy},key:a,className:`menu_item ${e==t.reportBy?"active":""}`},s.a.createElement("div",{className:"info"},t.title)))}showMenu(){let e=this.props.mainState.pageId;return[{pageId:"orders",title:"Quản lý đơn hàng"},{pageId:"stores",title:"Quản lý nhà thuốc"},{pageId:"plan",title:"Quản lý kế hoạch"}].map((t,a)=>s.a.createElement("div",{onClick:()=>{let e={pageId:t.pageId};this.props.dispatch(d(e))},key:a,className:`menu_item ${e==t.pageId?"active":""}`},s.a.createElement("div",{className:"info"},t.title)))}render(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"main_menu"},this.showChartMenu(),this.showMenu()))}}),h=a(11),u=a(51),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};var m=class extends s.a.Component{constructor(e){super(e),this.handleChange=((e,{name:t,value:a})=>this.setState({[t]:a})),this.handleSubmit=(()=>{if(this.props.onSubmit){var e=this.state;let t=e.store_id,a=e.name,r=e.address,s=e.owner,n=e.phone,i=e.district_id,l=e.area_id,o=e.province_id;if(""==r||"0"==i||""==i)return alert("Hãy nhập đầy đủ thông tin ở các trường có dấu (*)"),!1;let d=this.state.districts.filter(e=>e.code==this.state.district_id);this.props.onSubmit({store_id:t,name:a,address:r,phone:n,owner:s,district_id:i,area_id:l,province_id:o,huyen:d.length?d[0].name:""})}}),this.state={areas:[{key:"empty",value:"",text:"Chọn miền"},{key:"b",value:"b",text:"Miền Bắc"},{key:"t",value:"t",text:"Miền Trung"},{key:"n",value:"n",text:"Miền Nam"}],provinces:[],districts:[],area_id:"",province_id:"",district_id:""}}componentDidMount(){fetch(ISD_BASE_URL+"storeslocation").then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.provinces.length&&e.data.district.length&&this.setState({provinces:e.data.provinces,districts:e.data.district})}).catch(e=>{console.log("parsing failed",e)})}getPrivinceOptions(){if(this.state.provinces.length){let e=this.state.provinces;return this.state.area_id&&(e=this.state.provinces.filter(e=>e.area_code==this.state.area_id)),e.map(e=>({key:e.code,value:e.code,text:e.name}))}return[{key:"empty",value:"",text:"Chọn miền trước"}]}getDistrictOptions(){if(this.state.districts.length){let e=this.state.districts;return this.state.province_id&&(e=this.state.districts.filter(e=>e.parent_code==this.state.province_id)),e.map(e=>({key:e.code,value:e.code,text:e.name}))}return[{key:"empty",value:"",text:"Chọn tỉnh trước"}]}static getDerivedStateFromProps(e,t){return p({},e.data)}render(){var e=this.state;let t=e.store_id,a=e.name,r=e.address,n=e.phone,i=e.owner,l=e.district_id,o=e.area_id,d=e.province_id;return s.a.createElement(h.h,{inverted:!0,color:"teal",style:{textAlign:"left",width:600,position:"fixed",top:50,right:38,zIndex:1e3}},s.a.createElement("h2",{style:{textAlign:"center",textTransform:"uppercase"}},"Thông tin nhà thuốc"),s.a.createElement(h.c,{onSubmit:this.handleSubmit},s.a.createElement(h.c.Group,{widths:"equal"},s.a.createElement(h.c.Input,{value:t,onChange:this.handleChange,readOnly:!0,name:"store_id",label:"Mã nhà thuốc",placeholder:"Tự động sinh mã"}),s.a.createElement(h.c.Input,{value:a,onChange:this.handleChange,name:"name",label:"Tên nhà thuốc",placeholder:"Tên nhà thuốc"})),s.a.createElement(h.c.TextArea,{value:r,onChange:this.handleChange,required:!0,name:"address",label:"Địa chỉ",placeholder:"Địa chỉ"}),s.a.createElement(h.c.Group,{widths:"equal"},s.a.createElement(h.c.Input,{value:n||"",onChange:this.handleChange,name:"phone",label:"Điện thoại",placeholder:"Điện thoại"}),s.a.createElement(h.c.Input,{value:i||"",onChange:this.handleChange,name:"owner",label:"Chủ hiệu thuốc",placeholder:"Chủ hiệu thuốc"})),s.a.createElement(h.c.Group,{widths:"equal"},s.a.createElement(h.c.Select,{compact:!0,name:"area_id",options:this.state.areas,value:o,label:"Miền",onChange:this.handleChange}),s.a.createElement(h.c.Select,{compact:!0,name:"province_id",search:!0,value:d,options:this.getPrivinceOptions(),onChange:this.handleChange,label:"Tỉnh/TP"}),s.a.createElement(h.c.Select,{required:!0,search:!0,options:this.getDistrictOptions(),onChange:this.handleChange,compact:!0,value:l,name:"district_id",label:"Quận/Huyện"})),s.a.createElement(h.a,{primary:!0},"Lưu nhà thuốc"),""!=this.state.store_id?s.a.createElement(h.a,{type:"button",color:"red",onClick:e=>{confirm("Bạn thật sự muốn xoá hiệu thuốc này?")&&this.props.onDelete(this.state.store_id)}},"Xoá"):null,s.a.createElement(h.a,{type:"button",color:"orange",onClick:e=>{this.props.onCancel(e)}},"Huỷ")))}},g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};class v extends s.a.Component{constructor(e){super(e),this.handleRowClick=this.handleRowClick.bind(this),this.state={data:this.props.data||[],currentStore:g({},this.getResetDataField()),showForm:!1}}getResetDataField(){return{store_id:"",name:"",address:"",phone:"",owner:"",district_id:""}}handleRowClick(e){this.setState({currentStore:e,showForm:!0})}updateDataToServer(e){fetch(ISD_BASE_URL+"updatestore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(e.data){let t;t=e.newRecord?this.state.data.concat(e.data):this.state.data.map(t=>t.store_id==e.data.store_id?g({},t,e.data):t),this.setState({data:t,showForm:!1,currentStore:g({},this.getResetDataField())})}else this.setState({showForm:!1})}).catch(e=>{console.log("parsing failed",e)})}deleteStore(e){fetch(ISD_BASE_URL+`deletestore/${e}`,{method:"GET"}).then(e=>e.json()).then(e=>{if(e.data){let t=this.state.data.filter(t=>t.store_id!=e.data);this.setState({data:t,showForm:!1,currentStore:g({},this.getResetDataField())})}}).catch(e=>{console.log("parsing failed",e)})}customFilter(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}customFilterDistrict(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}render(){var e=this.state;const t=e.data,a=e.currentStore;return s.a.createElement("div",null,s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Danh sách các nhà thuốc")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{onClick:()=>{this.setState({showForm:!0,currentStore:g({},this.getResetDataField())})},type:"button",className:"ui button primary"},"Thêm hiệu thuốc"))),this.state.showForm?s.a.createElement(m,{data:a,onSubmit:e=>{this.updateDataToServer(e)},onCancel:e=>{this.setState({showForm:!1,currentStore:g({},this.getResetDataField())})},onDelete:e=>{this.deleteStore(e)}}):null,s.a.createElement(u.a,{getTdProps:(e,t,a,r)=>({onClick:(e,a)=>{this.handleRowClick(t.original),a&&a()}}),columns:[{Header:"Thông tin nhà thuốc",columns:[{Header:"Mã KH",accessor:"store_id",maxWidth:100},{Header:"Tên nhà thuốc",accessor:"name",filterMethod:this.customFilter},{Header:"Địa chỉ",accessor:"address",filterMethod:this.customFilter},{Header:"Điện thoại",accessor:"phone"},{Header:"Chủ",accessor:"owner"},{Header:"Mã Quận/Huyện (*)",accessor:"huyen",filterMethod:this.customFilterDistrict,Cell:e=>s.a.createElement("div",{className:`${0==e.original.district_id?"ui warning message":""}`,style:{padding:2}},0!=e.original.district_id?e.original.huyen:"Chọn mã quận/huyện")}]}],data:t,filterable:!0,defaultPageSize:20,className:"-striped -highlight"}))}}class f extends s.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.state={dataUpToDate:null,url:this.props.url,stores:[]}}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({dataUpToDate:!0,stores:e.data})}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){return s.a.createElement("div",{className:"ui segment"},this.state.dataUpToDate?s.a.createElement(s.a.Fragment,null,s.a.createElement(v,{data:this.state.stores})):s.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var E=a(126),S=a.n(E),_=a(36),b=a.n(_),y=a(72),D=a.n(y);class w extends r.Component{constructor(e){super(e),this.resetComponent=(()=>this.setState({isLoading:!1,results:[],value:""})),this.handleResultSelect=((e,{result:t})=>{this.props.onResultSelect&&this.props.onResultSelect(t),this.setState({value:t.store_id})}),this.handleSearchChange=((e,{value:t})=>{this.setState({isLoading:!0,value:t}),setTimeout(()=>{if(this.state.value.length<1)return this.resetComponent();const e=new RegExp(D()(this.state.value),"i");this.setState({isLoading:!1,results:b()(this.props.source,t=>e.test(t.title))})},300)}),this.state={isLoading:!1,results:[],value:""}}static getDerivedStateFromProps(e,t){return""==e.storeId||{value:e.storeId}}render(){var e=this.state;const t=e.isLoading,a=e.value,r=e.results;return s.a.createElement(h.g,{aligned:"right",loading:t,onResultSelect:this.handleResultSelect,onSearchChange:S()(this.handleSearchChange,500,{leading:!0}),results:r,value:a,resultRenderer:({title:e,description:t,store_id:a})=>s.a.createElement("div",null,`${e}`),fluid:!0,source:this.props.source})}}class C extends r.Component{constructor(e){super(e),this.resetComponent=(()=>this.setState({isLoading:!1,results:[],value:""})),this.handleResultSelect=((e,{result:t})=>{this.props.onResultSelect&&this.props.onResultSelect(t),this.setState({value:t.store_id})}),this.handleSearchChange=((e,{value:t})=>{this.setState({isLoading:!0,value:t}),setTimeout(()=>{if(this.state.value.length<1)return this.resetComponent();const e=new RegExp(D()(this.state.value),"i");this.setState({isLoading:!1,results:b()(this.props.source,t=>e.test(t.title))})},300)}),this.state={isLoading:!1,results:[],value:""}}static getDerivedStateFromProps(e,t){return""==e.districtId||{value:e.districtId}}render(){var e=this.state;const t=e.isLoading,a=e.value,r=e.results;return s.a.createElement(h.g,{aligned:"right",loading:t,onResultSelect:this.handleResultSelect,onSearchChange:S()(this.handleSearchChange,500,{leading:!0}),results:r,value:a,resultRenderer:({title:e,description:t,district_id:a})=>s.a.createElement("div",null,`${e}`),fluid:!0,source:this.props.source})}}class T extends s.a.Component{constructor(e){super(e),this.upload=this.upload.bind(this),this.chooseFile=this.chooseFile.bind(this),this.state={progressing:0,upload:!1,error:!1,errorMessage:this.props.errorMessage||"Xin lỗi! file chưa được upload thành công!"}}upload(e,t){let a=this;var r=new XMLHttpRequest;r.open("POST",t,!0),this.setState({upload:!0}),r.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;a.setState({progressing:parseInt(t)})}},r.onload=function(){if(200==this.status&&(a.setState({upload:!1,progressing:0,error:!1}),a.props.done)){a.props.done(this.response);let e=JSON.parse(this.response);"error"==e.status&&a.setState({error:!0,errorMessage:e.message||this.state.errorMessage})}},r.onerror=function(){a.setState({upload:!0,progressing:1,error:!0})},r.send(e)}chooseFile(e){var t=e.target.files,a=new FormData;a.append("filename",t[0]),this.upload(a,this.props.url)}render(){return s.a.createElement("div",{className:"file-upload",style:this.props.style},s.a.createElement("input",{type:"file",onChange:e=>this.chooseFile(e)}),this.state.upload?s.a.createElement(h.f,{style:{marginTop:10},percent:this.state.progressing,color:"olive",progress:!0,indicating:!0}):null,this.state.error?s.a.createElement("div",{className:"ui message warning"},this.state.errorMessage):null)}}var x=class extends s.a.Component{constructor(e){super(e),this.renderEditableNumber=this.renderEditableNumber.bind(this),this.renderEditableText=this.renderEditableText.bind(this),this.renderEditableArea=this.renderEditableArea.bind(this),this.renderEditable=this.renderEditable.bind(this),this.updateRowData=this.updateRowData.bind(this),this.state={preOrderData:[],stores:[],products:[],deliveries:[],productIds:[],storeIds:[],deliveryIds:[],districtIds:[],districts:[],units:this.getUnitOptions(),unitIds:["Hộp","Vỉ","Lọ"]}}getUnitOptions(){return[{key:"Hộp",value:"Hộp",text:"Hộp"},{key:"Vỉ",value:"Vỉ",text:"Vỉ"},{key:"Lọ",value:"Lọ",text:"Lọ"}]}getAreaOptions(){return[{key:"Bắc",value:"Bắc",text:"Bắc"},{key:"Trung",value:"Trung",text:"Trung"},{key:"Nam",value:"Nam",text:"Nam"}]}renderEditableNumber(e){return s.a.createElement(h.d,{error:""==e.value,type:"number",min:0,fluid:!0,defaultValue:e.value,onBlur:t=>{this.updateRowData(e,t.target.value)}})}renderEditable(e){return s.a.createElement("div",{className:"editable-input",style:{backgroundColor:"#fafafa"},contentEditable:!0,suppressContentEditableWarning:!0,onBlur:t=>{const a=[...this.state.preOrderData];a[e.index][e.column.id]=t.target.innerHTML,this.setState({preOrderData:a})},dangerouslySetInnerHTML:{__html:this.state.preOrderData[e.index][e.column.id]}})}renderEditableText(e){return s.a.createElement(h.d,{type:"text",error:""==e.value,required:!0,fluid:!0,defaultValue:this.state.preOrderData[e.index][e.column.id],onBlur:t=>{this.updateRowData(e,t.target.value)}})}renderEditableArea(e){return s.a.createElement(h.i,{required:!0,defaultValue:e.value,onBlur:t=>{this.updateRowData(e,t.target.value)}})}updateRowData(e,t){const a=[...this.state.preOrderData];a[e.index][e.column.id]=t,this.setState({preOrderData:a})}validDataBeforeSave(){let e=this.state.preOrderData,t=!0;if(e&&e.length)for(let a=0;a<e.length;a++){if(-1==this.state.productIds.indexOf(e[a].product_id)){alert(`Mã sản phẩm [${e[a].product_id}] chưa tồn tại trong hệ thống! Bạn hãy thêm sản phẩm mới hoặc chọn lại mã sản phẩm đúng!`),t=!1;break}if(""==e[a].date||!e[a].date){alert("Ngày mua không được để trống. Xin hãy nhập theo format ngay/thang/nam: VD: 24/05/2018"),t=!1;break}}return t}updateDataToServer(){if(!this.validDataBeforeSave())return!1;let e=this.state.preOrderData;fetch(ISD_BASE_URL+"addorders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.data?(alert(`Đã thêm ${e.data} hoá đơn vào cơ sở dữ liệu!`),this.setState({preOrderData:[]}),this.props.onAddOrderComplete&&this.props.onAddOrderComplete()):alert("Dữ liệu chưa được lưu vào hệ thống. Xin kiểm tra lại")}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){return fetch(ISD_BASE_URL+"importOrderData").then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;if(e.data&&e.data.stores.length&&e.data.products.length){let t=[],a=e.data.products.map(e=>(t.push(e.product_id),{key:e.product_id,value:e.product_id,text:e.name})),r=[],s=e.data.deliveries.map(e=>(r.push(e.delivery_id),{key:e.delivery_id,value:e.delivery_id,text:e.name})),n=[],i=e.data.stores.map(e=>(n.push(e.store_id),e)),l=[],o=e.data.districts.map(e=>(l.push(e.district_id),e));this.state.preOrderData.map(e=>{}),this.setState({stores:i,products:a,deliveries:s,districts:o,districtIds:l,productIds:t,storeIds:n,deliveryIds:r})}}).catch(e=>{console.log("parsing failed",e)}),!1}render(){let e=this.state.preOrderData;return s.a.createElement("div",{className:"order-add-form",style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"98%",background:"#fff",zIndex:1e3}},s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Form nhập đơn hàng")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("div",{className:"upload-btn primary",style:{position:"relative"}},s.a.createElement("button",{style:{position:"absolute",top:0,left:0,pointerEvents:"none",marginTop:10,zIndex:1,width:"100%"},type:"button",className:"fake-btn button ui primary"},"Import từ file excel"),s.a.createElement(T,{url:ISD_BASE_URL+"upload",done:e=>{let t=JSON.parse(e);"success"==t.status&&t.data&&this.setState({preOrderData:t.data})}}))),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{style:{marginTop:10},onClick:()=>{this.updateDataToServer()},type:"button",className:"ui button teal"},"Lưu hoá đơn"),s.a.createElement("button",{style:{marginTop:10},onClick:()=>{this.setState({preOrderData:[]}),this.props.onCancel()},type:"button",className:"ui button orange"},"Huỷ"))),s.a.createElement(u.a,{columns:[{Header:"Thông tin nhà thuốc",columns:[{Header:"Tìm nhà thuốc",accessor:"store_id",minWidth:200,Cell:e=>s.a.createElement("div",null,s.a.createElement(w,{onResultSelect:t=>{let a=[...this.state.preOrderData];if(a[e.index][e.column.id]=t.store_id,a[e.index].district_id=t.district_id,0!=t.district_id){let r=this.state.districts.filter(e=>e.district_id==t.district_id);r.length&&(a[e.index].district_name=r[0].huyen)}else a[e.index].district_id="",a[e.index].district_name="";a[e.index].address=t.address,a[e.index].name=t.name,this.setState({preOrderData:a})},storeId:-1==this.state.storeIds.indexOf(e.value)?"":e.value,source:this.state.stores}))},{Header:"Tên nhà thuốc",accessor:"name",minWidth:200,Cell:this.renderEditable},{Header:"Địa chỉ (*)",accessor:"address",minWidth:300,Cell:this.renderEditable},{Header:"Quận/Huyện/TP (*)",accessor:"district_name",minWidth:200,Cell:e=>s.a.createElement("div",{className:e.value?"":"store-item error"},e.value?s.a.createElement("div",null,s.a.createElement("span",null,e.value),s.a.createElement("button",{style:{float:"right"},onClick:()=>{const t=[...this.state.preOrderData];t[e.index][e.column.id]="",t[e.index].district_id="",this.setState({preOrderData:t})},className:"ui button icon basic compact circular tiny"},s.a.createElement("i",{className:"icon ui search"}))):s.a.createElement(C,{onResultSelect:t=>{const a=[...this.state.preOrderData];a[e.index][e.column.id]=t.huyen,a[e.index].district_id=t.district_id,this.setState({preOrderData:a})},source:this.state.districts}))}]},{Header:"Thông tin đơn hàng",columns:[{Header:"Mã sản phẩm",accessor:"product_id",minWidth:170,Cell:e=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h.b,{fluid:!0,selection:!0,style:{zIndex:100},search:!0,options:this.state.products,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}}))},{Header:"Ngày bán",accessor:"date",minWidth:150,Cell:this.renderEditable},{Header:"Số lượng",accessor:"qty",Cell:this.renderEditable},{Header:"Đơn giá",accessor:"price",Cell:this.renderEditable},{Header:"Đơn vị",accessor:"unit",Cell:e=>s.a.createElement(h.b,{error:-1==this.state.unitIds.indexOf(e.value),selection:!0,fluid:!0,compact:!0,style:{zIndex:0},options:this.state.units,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}})},{Header:"Mã NPP",accessor:"delivery_id",minWidth:100}]}],filterable:!0,data:e,defaultPageSize:20,className:"-striped -highlight",style:{height:"500px"}}))}},N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};class O extends s.a.Component{constructor(e){super(e),this.handleRowClick=this.handleRowClick.bind(this),this.refreshOrderData=this.refreshOrderData.bind(this),this.state={data:this.props.data||[],currentStore:N({},this.getResetDataField()),showForm:!1}}getResetDataField(){return{store_id:"",name:"",address:"",phone:"",owner:"",district_id:""}}handleRowClick(e){return!1}updateDataToServer(e){fetch(ISD_BASE_URL+"updatestore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(e.data){let t;t=e.newRecord?this.state.data.concat(e.data):this.state.data.map(t=>t.store_id==e.data.store_id?N({},t,e.data):t),this.setState({data:t,showForm:!1,currentStore:N({},this.getResetDataField())})}else this.setState({showForm:!1})}).catch(e=>{console.log("parsing failed",e)})}deleteStore(e){fetch(ISD_BASE_URL+`deletestore/${e}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{if(e.data){let t=this.state.data.filter(t=>t.store_id!=e.data);this.setState({data:t,showForm:!1,currentStore:N({},this.getResetDataField())})}}).catch(e=>{console.log("parsing failed",e)})}customFilter(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}customFilterDistrict(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}refreshOrderData(){fetch(ISD_BASE_URL+"orders").then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({data:e.data})}).catch(e=>{console.log("parsing failed",e)})}render(){var e=this.state;const t=e.data,a=e.currentStore;return s.a.createElement("div",null,s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Danh sách hoá đơn")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{onClick:()=>{this.setState({showForm:!0,currentStore:N({},this.getResetDataField())})},type:"button",className:"ui button primary"},"Nhập hoá đơn"))),this.state.showForm?s.a.createElement(x,{data:a,onAddOrderComplete:()=>{this.setState({showForm:!1}),this.refreshOrderData()},onCancel:e=>{this.setState({showForm:!1})},onDelete:e=>{this.deleteStore(e)}}):null,s.a.createElement(u.a,{getTdProps:(e,t,a,r)=>({onClick:(e,a)=>{this.handleRowClick(t.original),a&&a()}}),columns:[{Header:"Mã hoá đơn",columns:[{Header:"Mã nhà thuốc",accessor:"store_id",maxWidth:100},{Header:"Mã sản phẩm",accessor:"product_id",maxWidth:100},{Header:"Mã NPP",accessor:"delivery_id",maxWidth:100}]},{Header:"Thông tin đơn hàng",columns:[{Header:"Ngày bán",accessor:"date"},{Header:"Số lượng",accessor:"qty"},{Header:"Đơn vị",accessor:"unit"},{Header:"Đơn giá",accessor:"price"}]}],data:t,filterable:!0,defaultPageSize:20,className:"-striped -highlight"}))}}class R extends s.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.state={dataUpToDate:null,url:this.props.url,datasource:[]}}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({dataUpToDate:!0,datasource:e.data})}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){return s.a.createElement("div",{className:"ui segment"},this.state.dataUpToDate?s.a.createElement(s.a.Fragment,null,s.a.createElement(O,{data:this.state.datasource})):s.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};const k=(e,t)=>Array.from(Array(t-e+1).keys()).map(t=>t+e);class A extends s.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.planColumns=this.planColumns.bind(this),this.renderEditableNumber=this.renderEditableNumber.bind(this),this.updateRowData=this.updateRowData.bind(this),this.addNewPlan=this.addNewPlan.bind(this),this.savePlan=this.savePlan.bind(this),this.state={dataUpToDate:null,url:this.props.url,datasource:[],products:[]}}updateRowData(e,t){const a=[...this.state.datasource];a[e.index][e.column.id]=t,this.setState({datasource:a})}renderEditableNumber(e){return s.a.createElement(h.d,{error:""==e.value,type:"number",min:0,fluid:!0,defaultValue:e.value||0,onChange:t=>{this.updateRowData(e,t.target.value)}})}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;let t={};e.plans&&(t.datasource=e.plans),e.products&&(t.products=e.products.map(e=>({key:e.product_id,value:e.product_id,text:e.name}))),this.setState(I({dataUpToDate:!0},t))}).catch(e=>{console.log("parsing failed",e)})}planColumns(){return k(1,52).map((e,t)=>({Header:`T${e}`,accessor:`w${e}`,maxWidth:100,Cell:this.renderEditableNumber}))}addNewPlan(){let e=I({plan_no:"",year:(new Date).getFullYear(),product_id:""},k(1,52).map(e=>{}));this.setState({datasource:this.state.datasource.concat(e)})}validDataBeforeSave(){let e=(e=>Object.keys(e).filter(t=>e[t]>1))((e=>e.reduce((e,t)=>Object.assign(e,{[t]:(e[t]||0)+1}),{}))(this.state.datasource.map(e=>`${e.year}_${e.product_id}`)));return!e.length||(alert("Có sản phẩm bị trùng kế hoạch: "+e[0]),!1)}savePlan(){if(!this.validDataBeforeSave())return!1;let e=this.state.datasource;fetch(ISD_BASE_URL+"updateplan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.data?alert("Đã cập nhật kế hoạch vào cơ sở dữ liệu!"):alert("Dữ liệu chưa được lưu vào hệ thống. Xin kiểm tra lại")}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){let e=this.state.datasource;return s.a.createElement("div",{className:"ui segment order-add-form"},this.state.dataUpToDate?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Kế hoạch theo từng tuần trong năm")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{onClick:()=>{this.addNewPlan()},type:"button",className:"ui button primary"},"Thêm kế hoạch"),s.a.createElement("button",{onClick:()=>{this.savePlan()},type:"button",className:"ui button teal"},"Lưu thay đổi"))),s.a.createElement(u.a,{getTdProps:(e,t,a,r)=>({onClick:(e,t)=>{t&&t()}}),columns:[{Header:"Thông tin kế hoạch",columns:[{Header:"Năm",accessor:"year",Cell:this.renderEditableNumber},{Header:"Sản phẩm",accessor:"product_id",minWidth:200,Cell:e=>s.a.createElement(h.b,{fluid:!0,selection:!0,style:{zIndex:100},search:!0,options:this.state.products,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}})}]},{Header:"Kế hoạch từng tuần trong năm",columns:this.planColumns()}],data:e,filterable:!0,defaultPageSize:20,className:"-striped -highlight",style:{maxWidth:980}})):s.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var P=Object(l.b)(e=>({mainState:e.main.present,uiState:e.ui}))(class extends r.Component{constructor(e){super(e),this.renderManagePage=this.renderManagePage.bind(this)}renderManagePage(){let e=this.props.mainState.pageId;switch(e){case"stores":return s.a.createElement(f,{url:ISD_BASE_URL+"stores"});case"orders":return s.a.createElement(R,{url:ISD_BASE_URL+"orders"});case"plan":return s.a.createElement(A,{url:ISD_BASE_URL+"plan"});default:return s.a.createElement("h1",null,"Render ",e," page")}}render(){return this.props.mainState.pageId,s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"grid-container"},s.a.createElement("div",{className:"header"},s.a.createElement("div",{className:"header_left"}),s.a.createElement("div",{className:"header_center"},s.a.createElement("h2",null,"Quản lý dữ liệu nhà thuốc, đơn hàng, sản phẩm")),s.a.createElement("div",{className:"header_right"},"Liên Kết")),s.a.createElement("div",{className:"menu menu_active"},s.a.createElement("a",{href:"#"},s.a.createElement("img",{width:"200",src:"images/logo-pharma.png"})),s.a.createElement("div",{className:"block_ava"},s.a.createElement("a",{href:"#"},s.a.createElement("img",{src:"images/ava.jpg"})),s.a.createElement("p",null,"Xin chào,",s.a.createElement("span",null,"Admin!"))),s.a.createElement(c,null)),s.a.createElement("div",{className:"isd_main"},s.a.createElement("div",{className:"main_content"},s.a.createElement("div",{className:"main_content_left active",page:"main"},s.a.createElement("div",{className:"list_infos"},this.renderManagePage()))))))}}),F=a(136),L=(a(297),a(181)),H=a.n(L),M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};let B,j={pageId:window.ISD_CURRENT_PAGE?window.ISD_CURRENT_PAGE:"orders"};var U=a(259),q=a.n(U);let W=[o.UPDATE_STATE_DATA];var $=Object(F.c)({main:q()((e=j,t)=>{switch(t.type){case o.START_APP:return B=H()(e),B=M({},B,t.defaultProps);case o.UPDATE_STATE_DATA:return B=H()(e),B=M({},B,t.updateData)}return e},{filter:(e,t,a)=>-1!==W.indexOf(e.type),limit:100})});const z=Object(F.a)(),V=Object(F.d)($,z);V.close=(()=>V.dispatch(END));var J,Q,X=V;Object.assign;window.ISD_BASE_URL&&""!=window.ISD_BASE_URL||(window.ISD_BASE_URL=window.location.protocol+"//"+(J=document.location.href,null!=(Q=J.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i))&&Q.length>2&&"string"==typeof Q[2]&&Q[2].length>0?Q[2]:null)+"/");const G=document.getElementById("isd_app");i.a.render(s.a.createElement(l.a,{store:X},s.a.createElement(P,null)),G)},517:function(e,t,a){e.exports=a(294)}});