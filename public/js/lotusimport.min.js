!function(e){function t(t){for(var r,i,l=t[0],o=t[1],d=t[2],h=0,u=[];h<l.length;h++)i=l[h],s[i]&&u.push(s[i][0]),s[i]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);for(c&&c(t);u.length;)u.shift()();return n.push.apply(n,d||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,l=1;l<a.length;l++){var o=a[l];0!==s[o]&&(r=!1)}r&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var r={},s={1:0},n=[];function i(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=r,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window.webpackJsonp=window.webpackJsonp||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var c=o;n.push([716,0]),a()}({474:function(e,t,a){"use strict";a.r(t);var r=a(0),s=a.n(r),n=a(11),i=a.n(n),l=a(95);var o={START_APP:"START_APP",UPDATE_STATE_DATA:"UPDATE_STATE_DATA"};const d=e=>({type:o.UPDATE_STATE_DATA,updateData:e});var c=Object(l.b)(e=>({mainState:e.main.present}))(class extends r.Component{constructor(e){super(e),this.showReportBy=this.showReportBy.bind(this),this.showMenu=this.showMenu.bind(this)}showReportBy(e){this.props.dispatch(d({pageId:e}))}showChartMenu(){let e=this.props.mainState.reportBy;return[{reportBy:"doanh_thu_tong",title:"Doanh thu theo năm"},{reportBy:"theo_mien",title:"Doanh thu theo miền"},{reportBy:"theo_tinh",title:"Doanh thu theo tỉnh",filter:{area:"b",quarter:1}}].map((t,a)=>s.a.createElement("div",{onClick:()=>{window.location.href=ISD_BASE_URL+"?page="+t.reportBy},key:a,className:`menu_item ${e==t.reportBy?"active":""}`},s.a.createElement("div",{className:"info"},t.title)))}showMenu(){let e=this.props.mainState.pageId;return[{pageId:"orders",title:"Quản lý đơn hàng"},{pageId:"stores",title:"Quản lý nhà thuốc"},{pageId:"products",title:"Quản lý sản phẩm"},{pageId:"tdv",title:"Quản lý TDV"},{pageId:"exchange",title:"Quản lý Đơn vị tính"},{pageId:"plan",title:"Quản lý kế hoạch"}].map((t,a)=>s.a.createElement("div",{onClick:()=>{let e={pageId:t.pageId};this.props.dispatch(d(e))},key:a,className:`menu_item ${e==t.pageId?"active":""}`},s.a.createElement("div",{className:"info"},t.title)))}render(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"main_menu",style:{marginTop:33}},this.showChartMenu(),this.showMenu()))}}),h=a(15),u=a(70),m=a(58),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};var g=class extends s.a.Component{constructor(e){super(e),this.handleChange=((e,{name:t,value:a})=>this.setState({[t]:a})),this.handleSubmit=(()=>{if(this.props.onSubmit){var e=this.state;let t=e.store_id,a=e.name,r=e.address,s=e.owner,n=e.phone,i=e.district_id,l=e.area_id,o=e.province_id;if(""==r||"0"==i||""==i)return alert("Hãy nhập đầy đủ thông tin ở các trường có dấu (*)"),!1;let d=this.state.districts.filter(e=>e.code==this.state.district_id);this.props.onSubmit({store_id:t,name:a,address:r,phone:n,owner:s,district_id:i,area_id:l,province_id:o,huyen:d.length?d[0].name:""})}}),this.state={areas:[{key:"empty",value:"",text:"Chọn miền"},{key:"b",value:"b",text:"Miền Bắc"},{key:"t",value:"t",text:"Miền Trung"},{key:"n",value:"n",text:"Miền Nam"}],provinces:[],districts:[],area_id:"",province_id:"",district_id:""}}componentDidMount(){fetch(ISD_BASE_URL+"storeslocation").then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.provinces.length&&e.data.district.length&&this.setState({provinces:e.data.provinces,districts:e.data.district})}).catch(e=>{console.log("parsing failed",e)})}getPrivinceOptions(){if(this.state.provinces.length){let e=this.state.provinces;return this.state.area_id&&(e=this.state.provinces.filter(e=>e.area_code==this.state.area_id)),e.map(e=>({key:e.code,value:e.code,text:e.name}))}return[{key:"empty",value:"",text:"Chọn miền trước"}]}getDistrictOptions(){if(this.state.districts.length){let e=this.state.districts;return this.state.province_id&&(e=this.state.districts.filter(e=>e.parent_code==this.state.province_id)),e.map(e=>({key:e.code,value:e.code,text:e.name}))}return[{key:"empty",value:"",text:"Chọn tỉnh trước"}]}static getDerivedStateFromProps(e,t){return p({},e.data)}render(){var e=this.state;let t=e.store_id,a=e.name,r=e.address,n=e.phone,i=e.owner,l=e.district_id,o=e.area_id,d=e.province_id;return s.a.createElement(h.h,{inverted:!0,color:"teal",style:{textAlign:"left",width:600,position:"fixed",top:50,right:38,zIndex:1e3}},s.a.createElement("h2",{style:{textAlign:"center",textTransform:"uppercase"}},"Thông tin nhà thuốc"),s.a.createElement(h.c,{onSubmit:this.handleSubmit},s.a.createElement(h.c.Group,{widths:"equal"},s.a.createElement(h.c.Input,{value:t,onChange:this.handleChange,readOnly:!0,name:"store_id",label:"Mã nhà thuốc",placeholder:"Tự động sinh mã"}),s.a.createElement(h.c.Input,{value:a,onChange:this.handleChange,name:"name",label:"Tên nhà thuốc",placeholder:"Tên nhà thuốc"})),s.a.createElement(h.c.TextArea,{value:r,onChange:this.handleChange,required:!0,name:"address",label:"Địa chỉ",placeholder:"Địa chỉ"}),s.a.createElement(h.c.Group,{widths:"equal"},s.a.createElement(h.c.Input,{value:n||"",onChange:this.handleChange,name:"phone",label:"Điện thoại",placeholder:"Điện thoại"}),s.a.createElement(h.c.Input,{value:i||"",onChange:this.handleChange,name:"owner",label:"Chủ hiệu thuốc",placeholder:"Chủ hiệu thuốc"})),s.a.createElement(h.c.Group,{widths:"equal"},s.a.createElement(h.c.Select,{compact:!0,name:"area_id",options:this.state.areas,value:o,label:"Miền",onChange:this.handleChange}),s.a.createElement(h.c.Select,{compact:!0,name:"province_id",search:!0,value:d,options:this.getPrivinceOptions(),onChange:this.handleChange,label:"Tỉnh/TP"}),s.a.createElement(h.c.Select,{required:!0,search:!0,options:this.getDistrictOptions(),onChange:this.handleChange,compact:!0,value:l,name:"district_id",label:"Quận/Huyện"})),s.a.createElement(h.a,{primary:!0},"Lưu nhà thuốc"),s.a.createElement(m.a,{placement:"left",title:"Bạn thật sự muốn huỷ?",onConfirm:e=>{this.props.onCancel(e)}},s.a.createElement(h.a,{type:"button",color:"orange"},"Huỷ"))))}},f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};class v extends s.a.Component{constructor(e){super(e),this.handleRowClick=this.handleRowClick.bind(this),this.state={data:this.props.data||[],currentStore:f({},this.getResetDataField()),showForm:!1}}getResetDataField(){return{store_id:"",name:"",address:"",phone:"",owner:"",district_id:""}}handleRowClick(e){this.setState({currentStore:e,showForm:!0})}updateDataToServer(e){fetch(ISD_BASE_URL+"updatestore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(e.data){let t;t=e.newRecord?this.state.data.concat(e.data):this.state.data.map(t=>t.store_id==e.data.store_id?f({},t,e.data):t),this.setState({data:t,showForm:!1,currentStore:f({},this.getResetDataField())})}else this.setState({showForm:!1})}).catch(e=>{console.log("parsing failed",e)})}deleteStore(e){fetch(ISD_BASE_URL+`deletestore/${e}`,{method:"GET"}).then(e=>e.json()).then(e=>{if(e.data){let t=this.state.data.filter(t=>t.store_id!=e.data);this.setState({data:t})}}).catch(e=>{console.log("parsing failed",e)})}customFilter(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}customFilterDistrict(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}render(){var e=this.state;const t=e.data,a=e.currentStore;return s.a.createElement("div",null,s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Danh sách các nhà thuốc")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{onClick:()=>{this.setState({showForm:!0,currentStore:f({},this.getResetDataField())})},type:"button",className:"ui button primary"},"Thêm hiệu thuốc"))),this.state.showForm?s.a.createElement(g,{data:a,onSubmit:e=>{this.updateDataToServer(e)},onCancel:e=>{this.setState({showForm:!1,currentStore:f({},this.getResetDataField())})}}):null,s.a.createElement(u.a,{columns:[{Header:"Thông tin nhà thuốc",columns:[{Header:"Mã KH",accessor:"store_id",maxWidth:100},{Header:"Tên nhà thuốc",accessor:"name",filterMethod:this.customFilter},{Header:"Địa chỉ",accessor:"address",filterMethod:this.customFilter},{Header:"Điện thoại",accessor:"phone"},{Header:"Chủ",accessor:"owner"},{Header:"Mã Quận/Huyện (*)",accessor:"huyen",filterMethod:this.customFilterDistrict,Cell:e=>s.a.createElement("div",{className:`${0==e.original.district_id?"ui warning message":""}`,style:{padding:2}},0!=e.original.district_id?e.original.huyen:"Chọn mã quận/huyện")}]},{Header:"Actions",columns:[{Header:"Sửa | Xoá",accessor:"store_id",filterable:!1,Cell:e=>s.a.createElement(s.a.Fragment,null,s.a.createElement("button",{onClick:()=>{this.handleRowClick(e.original)},className:"ui icon button teal tiny",role:"button"},s.a.createElement("i",{"aria-hidden":"true",className:"edit icon"})),s.a.createElement(m.a,{placement:"left",okType:"danger",title:"Bạn thật sự muốn xoá?",onConfirm:()=>{this.deleteStore(e.value)}},s.a.createElement("button",{className:"ui icon button red tiny",role:"button"},s.a.createElement("i",{"aria-hidden":"true",className:"remove icon"}))))}]}],data:t,filterable:!0,defaultPageSize:20,className:"-striped -highlight"}))}}class E extends s.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.state={dataUpToDate:null,url:this.props.url,stores:[]}}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({dataUpToDate:!0,stores:e.data})}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){return s.a.createElement("div",{className:"ui segment"},this.state.dataUpToDate?s.a.createElement(s.a.Fragment,null,s.a.createElement(v,{data:this.state.stores})):s.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var y=a(8),b=a.n(y),S=a(159),_=a.n(S),j=a(51),D=a.n(j),w=a(97),x=a.n(w);class C extends r.Component{constructor(e){super(e),this.resetComponent=(()=>this.setState({isLoading:!1,results:[],value:""})),this.handleResultSelect=((e,{result:t})=>{this.props.onResultSelect&&this.props.onResultSelect(t),this.setState({value:t.store_id})}),this.handleSearchChange=((e,{value:t})=>{this.setState({isLoading:!0,value:t}),setTimeout(()=>{if(this.state.value.length<1)return this.resetComponent();const e=new RegExp(x()(this.state.value),"i");this.setState({isLoading:!1,results:D()(this.props.source,t=>e.test(t.title))})},300)}),this.state={isLoading:!1,results:[],value:""}}static getDerivedStateFromProps(e,t){return e.storeId==t.value||{value:e.storeId}}render(){var e=this.state;const t=e.isLoading,a=e.value,r=e.results;return s.a.createElement(h.g,{aligned:"right",loading:t,onResultSelect:this.handleResultSelect,onSearchChange:_()(this.handleSearchChange,500,{leading:!0}),results:r,value:a,resultRenderer:({title:e,description:t,store_id:a})=>s.a.createElement("div",null,`${e}`),fluid:!0,source:this.props.source})}}class k extends r.Component{constructor(e){super(e),this.resetComponent=(()=>this.setState({isLoading:!1,results:[],value:""})),this.handleResultSelect=((e,{result:t})=>{this.props.onResultSelect&&this.props.onResultSelect(t),this.setState({value:t.store_id})}),this.handleSearchChange=((e,{value:t})=>{this.setState({isLoading:!0,value:t}),setTimeout(()=>{if(this.state.value.length<1)return this.resetComponent();const e=new RegExp(x()(this.state.value),"i");this.setState({isLoading:!1,results:D()(this.props.source,t=>e.test(t.title))})},300)}),this.state={isLoading:!1,results:[],value:""}}static getDerivedStateFromProps(e,t){return e.districtId==t.value||{value:e.districtId}}render(){var e=this.state;const t=e.isLoading,a=e.value,r=e.results;return s.a.createElement(h.g,{aligned:"right",loading:t,onResultSelect:this.handleResultSelect,onSearchChange:_()(this.handleSearchChange,500,{leading:!0}),results:r,value:a,resultRenderer:({title:e,description:t,district_id:a})=>s.a.createElement("div",null,`${e}`),fluid:!0,source:this.props.source})}}class I extends s.a.Component{constructor(e){super(e),this.upload=this.upload.bind(this),this.chooseFile=this.chooseFile.bind(this),this.state={progressing:0,upload:!1,error:!1,errorMessage:this.props.errorMessage||"Xin lỗi! file chưa được upload thành công!"}}upload(e,t){let a=this;var r=new XMLHttpRequest;r.open("POST",t,!0),this.setState({upload:!0}),r.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;a.setState({progressing:parseInt(t)})}},r.onload=function(){if(200==this.status&&(a.setState({upload:!1,progressing:0,error:!1}),a.props.done)){a.props.done(this.response);let e=JSON.parse(this.response);"error"==e.status&&a.setState({error:!0,errorMessage:e.message||this.state.errorMessage})}},r.onerror=function(){a.setState({upload:!0,progressing:1,error:!0})},r.send(e)}chooseFile(e){var t=e.target.files,a=new FormData;a.append("filename",t[0]),this.upload(a,this.props.url)}render(){return s.a.createElement("div",{className:"file-upload",style:this.props.style},s.a.createElement("input",{type:"file",onChange:e=>this.chooseFile(e)}),this.state.upload?s.a.createElement(h.f,{style:{marginTop:10},percent:this.state.progressing,color:"olive",progress:!0,indicating:!0}):null,this.state.error?s.a.createElement("div",{className:"ui message warning"},this.state.errorMessage):null)}}var O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};var T=class extends s.a.Component{constructor(e){super(e),this.renderEditableNumber=this.renderEditableNumber.bind(this),this.renderEditableText=this.renderEditableText.bind(this),this.renderEditableArea=this.renderEditableArea.bind(this),this.renderEditable=this.renderEditable.bind(this),this.updateRowData=this.updateRowData.bind(this),this.fetchData=this.fetchData.bind(this),this.state={preOrderData:[],stores:[],products:[],deliveries:[],productIds:[],storeIds:[],deliveryIds:[],districtIds:[],districts:[],units:this.getUnitOptions(),unitIds:["Hộp","Vỉ","Lọ"]}}getUnitOptions(){return[{key:"Hộp",value:"Hộp",text:"Hộp"},{key:"Vỉ",value:"Vỉ",text:"Vỉ"},{key:"Lọ",value:"Lọ",text:"Lọ"}]}getAreaOptions(){return[{key:"Bắc",value:"Bắc",text:"Bắc"},{key:"Trung",value:"Trung",text:"Trung"},{key:"Nam",value:"Nam",text:"Nam"}]}renderEditableNumber(e){return s.a.createElement(h.d,{error:""==e.value,type:"number",min:0,fluid:!0,defaultValue:e.value,onBlur:t=>{this.updateRowData(e,t.target.value)}})}renderEditable(e){return s.a.createElement("div",{className:"editable-input",style:{backgroundColor:"#fafafa"},contentEditable:!0,suppressContentEditableWarning:!0,onBlur:t=>{const a=[...this.state.preOrderData];a[e.index][e.column.id]=t.target.innerHTML,this.setState({preOrderData:a})},dangerouslySetInnerHTML:{__html:this.state.preOrderData[e.index][e.column.id]}})}renderEditableText(e){return s.a.createElement(h.d,{type:"text",error:""==e.value,required:!0,fluid:!0,defaultValue:this.state.preOrderData[e.index][e.column.id],onBlur:t=>{this.updateRowData(e,t.target.value)}})}renderEditableArea(e){return s.a.createElement(h.i,{required:!0,defaultValue:e.value,onBlur:t=>{this.updateRowData(e,t.target.value)}})}updateRowData(e,t){const a=[...this.state.preOrderData];a[e.index][e.column.id]=t,this.setState({preOrderData:a})}validDataBeforeSave(){let e=this.state.preOrderData,t=!0;if(e&&e.length)for(let a=0;a<e.length;a++){if(-1==this.state.productIds.indexOf(e[a].product_id)){alert(`Mã sản phẩm [${e[a].product_id}] chưa tồn tại trong hệ thống! Bạn hãy thêm sản phẩm mới hoặc chọn lại mã sản phẩm đúng!`),t=!1;break}if(""==e[a].date||!e[a].date){alert("Ngày mua không được để trống. Xin hãy nhập theo format ngay/thang/nam: VD: 24/05/2018"),t=!1;break}}return t}updateDataToServer(){if(!this.validDataBeforeSave())return!1;let e=this.state.preOrderData;fetch(ISD_BASE_URL+"addorders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.data?(alert(`Đã cập nhật ${e.data} hoá đơn vào cơ sở dữ liệu!`),this.setState({preOrderData:[]}),this.props.onAddOrderComplete&&this.props.onAddOrderComplete()):alert("Dữ liệu chưa được lưu vào hệ thống. Xin kiểm tra lại")}).catch(e=>{console.log("parsing failed",e)})}static getDerivedStateFromProps(e,t){if(e.data&&e.data.order_id){let t=O({},e.data,{date:b()(e.data.date).format("DD/MM/YYYY")});return{order_id:t.order_id,preOrderData:[t],dataUpToDate:null}}return!0}componentDidUpdate(){null===this.state.dataUpToDate&&this.state.order_id&&this.fetchData(()=>{let e=[...this.state.preOrderData],t=this.state.stores.filter(t=>t.store_id==e[0].store_id),a=this.state.districts.filter(e=>e.district_id==t[0].district_id);e[0]=O({},e[0],t[0],{district_name:a[0].huyen}),this.setState({dataUpToDate:!0,preOrderData:e})})}fetchData(e){return fetch(ISD_BASE_URL+"importOrderData").then(e=>e.json()).then(t=>{if(t.status&&"error"==t.status)return console.warn(t.message),!1;if(t.data&&t.data.stores.length&&t.data.products.length){let a=[],r=t.data.products.map(e=>(a.push(e.product_id),{key:e.product_id,value:e.product_id,text:e.name})),s=[],n=t.data.deliveries.map(e=>(s.push(e.delivery_id),{key:e.delivery_id,value:e.delivery_id,text:e.name})),i=[],l=t.data.stores.map(e=>(i.push(e.store_id),e)),o=[],d=t.data.districts.map(e=>(o.push(e.district_id),e));this.setState({stores:l,products:r,deliveries:n,districts:d,districtIds:o,productIds:a,storeIds:i,deliveryIds:s}),e&&e()}}).catch(e=>{console.log("parsing failed",e)}),!1}componentDidMount(){this.fetchData()}getDefaultItemField(){return{store_id:"",name:"",address:"",product_id:"",delivery_id:"",date:"",qty:"",price:"",unit:"",district_id:"",district_name:"",name_address:"",tdv:""}}addNewOrder(){this.setState({preOrderData:this.state.preOrderData.concat(this.getDefaultItemField())})}render(){let e=this.state.preOrderData;return s.a.createElement("div",{className:"order-add-form",style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"98%",background:"#fff",zIndex:1e3}},s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Form nhập đơn hàng")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("div",{className:"upload-btn primary",style:{position:"relative"}},s.a.createElement("button",{style:{position:"absolute",top:0,left:0,pointerEvents:"none",marginTop:10,zIndex:1,width:"100%"},type:"button",className:"fake-btn button ui primary"},"Import từ file excel"),s.a.createElement(I,{url:ISD_BASE_URL+"upload",done:e=>{let t=JSON.parse(e);"success"==t.status&&t.data&&this.setState({preOrderData:t.data})}}))),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{style:{marginTop:10},onClick:()=>{this.addNewOrder()},type:"button",className:"ui button primary"},"Thêm hoá đơn"),s.a.createElement("button",{style:{marginTop:10},onClick:()=>{this.updateDataToServer()},type:"button",className:"ui button teal"},"Lưu hoá đơn"),s.a.createElement(m.a,{placement:"left",title:"Bạn thật sự muốn huỷ?",onConfirm:()=>{this.setState({preOrderData:[]}),this.props.onCancel()}},s.a.createElement("button",{style:{marginTop:10},type:"button",className:"ui button orange"},"Huỷ")))),s.a.createElement(u.a,{columns:[{Header:"Thông tin nhà thuốc",columns:[{Header:"Tìm nhà thuốc",accessor:"store_id",minWidth:200,Cell:e=>s.a.createElement("div",{style:{position:"relative"},className:""!=e.value?"store-exitst":""},""==e.value?s.a.createElement("label",{className:"ui teal floating left label tiny"},"Mới"):null,s.a.createElement(C,{onResultSelect:t=>{let a=[...this.state.preOrderData];if(a[e.index][e.column.id]=t.store_id,a[e.index].district_id=t.district_id,0!=t.district_id){let r=this.state.districts.filter(e=>e.district_id==t.district_id);r.length&&(a[e.index].district_name=r[0].huyen)}else a[e.index].district_id="",a[e.index].district_name="";a[e.index].address=t.address,a[e.index].name=t.name,this.setState({preOrderData:a})},storeId:-1==this.state.storeIds.indexOf(e.value)?"":e.value,source:this.state.stores}))},{Header:"Tên nhà thuốc",accessor:"name",minWidth:200,Cell:this.renderEditable},{Header:"Địa chỉ (*)",accessor:"address",minWidth:300,Cell:this.renderEditable},{Header:"Quận/Huyện/TP (*)",accessor:"district_name",minWidth:200,Cell:e=>s.a.createElement("div",{className:e.value?"":"store-item error"},e.value?s.a.createElement("div",null,s.a.createElement("span",null,e.value),s.a.createElement("button",{style:{float:"right"},onClick:()=>{const t=[...this.state.preOrderData];t[e.index][e.column.id]="",t[e.index].district_id="",this.setState({preOrderData:t})},className:"ui button icon basic compact circular tiny"},s.a.createElement("i",{className:"icon ui search"}))):s.a.createElement(k,{onResultSelect:t=>{const a=[...this.state.preOrderData];a[e.index][e.column.id]=t.huyen,a[e.index].district_id=t.district_id,this.setState({preOrderData:a})},source:this.state.districts}))}]},{Header:"Thông tin đơn hàng",columns:[{Header:"Mã sản phẩm",accessor:"product_id",minWidth:170,Cell:e=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h.b,{fluid:!0,selection:!0,style:{zIndex:100},search:!0,options:this.state.products,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}}))},{Header:"Ngày bán",accessor:"date",minWidth:150,Cell:this.renderEditable},{Header:"Số lượng",accessor:"qty",Cell:this.renderEditable},{Header:"Đơn giá",accessor:"price",Cell:this.renderEditable},{Header:"Đơn vị",accessor:"unit",Cell:e=>s.a.createElement(h.b,{error:-1==this.state.unitIds.indexOf(e.value),selection:!0,fluid:!0,compact:!0,style:{zIndex:0},options:this.state.units,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}})},{Header:"Mã NPP",accessor:"delivery_id",minWidth:100,Cell:e=>s.a.createElement(h.b,{error:-1==this.state.deliveryIds.indexOf(e.value),selection:!0,fluid:!0,style:{zIndex:0},search:!0,options:this.state.deliveries,onChange:(t,a)=>{this.updateRowData(e,a.value)},value:e.value})},{Header:"Mã TDV",accessor:"tdv",minWidth:100,Cell:this.renderEditable},{Header:"Action",accessor:"store_id",filterable:!1,minWidth:100,Cell:e=>s.a.createElement(s.a.Fragment,null,s.a.createElement("button",{onClick:()=>{let t=e.row.name+" "+e.row.address;if(!confirm("Bạn có thật sự muốn xoá bản ghi : "+t))return!1;const a=this.state.preOrderData.filter((t,a)=>e.index!=a);this.setState({preOrderData:a})},className:"ui icon button red",role:"button"},s.a.createElement("i",{"aria-hidden":"true",className:"remove icon"})))}]}],filterable:!0,data:e,defaultPageSize:20,className:"-striped -highlight",style:{height:"500px"}}))}},N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};class R extends s.a.Component{constructor(e){super(e),this.handleRowClick=this.handleRowClick.bind(this),this.refreshOrderData=this.refreshOrderData.bind(this),this.state={data:this.props.data||[],currentOrder:N({},this.getResetDataField()),showForm:!1}}getResetDataField(){return{order_id:"",name:"",address:"",phone:"",owner:"",district_id:""}}handleRowClick(e){this.setState({currentOrder:e,showForm:!0})}updateDataToServer(e){fetch(ISD_BASE_URL+"updatestore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(e.data){let t;t=e.newRecord?this.state.data.concat(e.data):this.state.data.map(t=>t.order_id==e.data.order_id?N({},t,e.data):t),this.setState({data:t,showForm:!1,currentOrder:N({},this.getResetDataField())})}else this.setState({showForm:!1})}).catch(e=>{console.log("parsing failed",e)})}deleteOrder(e){fetch(ISD_BASE_URL+`deleteorder/${e}`,{method:"get"}).then(e=>e.json()).then(e=>{if(e.data){let t=this.state.data.filter(t=>t.order_id!=e.data);this.setState({data:t,showForm:!1,currentOrder:N({},this.getResetDataField())})}}).catch(e=>{console.log("parsing failed",e)})}customFilter(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}customFilterDistrict(e,t){return!(!t[e.id]||""==t[e.id]||""==e.value)&&t[e.id].toLowerCase().includes(e.value.toLowerCase())}refreshOrderData(){fetch(ISD_BASE_URL+"orders").then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({data:e.data})}).catch(e=>{console.log("parsing failed",e)})}render(){var e=this.state;const t=e.data,a=e.currentOrder;return s.a.createElement("div",null,s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Danh sách hoá đơn")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{onClick:()=>{this.setState({showForm:!0,currentOrder:N({},this.getResetDataField())})},type:"button",className:"ui button primary"},"Nhập hoá đơn"))),this.state.showForm?s.a.createElement(T,{data:a,onAddOrderComplete:()=>{this.setState({showForm:!1}),this.refreshOrderData()},onCancel:e=>{this.setState({showForm:!1})}}):null,s.a.createElement(u.a,{columns:[{Header:"Mã hoá đơn",columns:[{Header:"OrderID",accessor:"order_id",maxWidth:100},{Header:"Mã nhà thuốc",accessor:"store_id",maxWidth:100},{Header:"Mã sản phẩm",accessor:"product_id",maxWidth:100},{Header:"Mã NPP",accessor:"delivery_id",maxWidth:100}]},{Header:"Thông tin đơn hàng",columns:[{Header:"Ngày bán",accessor:"date"},{Header:"Số lượng",accessor:"qty"},{Header:"Đơn vị",accessor:"unit"},{Header:"Đơn giá",accessor:"price"},{Header:"TDV",accessor:"tdv"}]},{Header:"Actions",columns:[{Header:"Sửa | Xoá",filterable:!1,accessor:"order_id",Cell:e=>s.a.createElement(s.a.Fragment,null,s.a.createElement("button",{onClick:()=>{this.handleRowClick(e.original)},className:"ui icon button teal tiny",role:"button"},s.a.createElement("i",{"aria-hidden":"true",className:"edit icon"})),s.a.createElement(m.a,{placement:"left",okType:"danger",title:"Bạn thật sự muốn xoá?",onConfirm:()=>{this.deleteOrder(e.value)}},s.a.createElement("button",{className:"ui icon button red tiny",role:"button"},s.a.createElement("i",{"aria-hidden":"true",className:"remove icon"}))))}]}],data:t,filterable:!0,defaultPageSize:20,className:"-striped -highlight"}))}}var P,A;Object.assign;window.ISD_BASE_URL&&""!=window.ISD_BASE_URL||(window.ISD_BASE_URL=window.location.protocol+"//"+(P=document.location.href,null!=(A=P.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i))&&A.length>2&&"string"==typeof A[2]&&A[2].length>0?A[2]:null)+"/");const L=()=>{let e=sessionStorage.getItem("ISD_TOKEN");if(""!=e&&null!=e)return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e}};class F extends s.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.state={dataUpToDate:null,url:this.props.url,datasource:[]}}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e,{headers:L()}).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;e.data&&e.data.length&&this.setState({dataUpToDate:!0,datasource:e.data})}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){return s.a.createElement("div",{className:"ui segment"},this.state.dataUpToDate?s.a.createElement(s.a.Fragment,null,s.a.createElement(R,{data:this.state.datasource})):s.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};const H=(e,t)=>Array.from(Array(t-e+1).keys()).map(t=>t+e);class U extends s.a.Component{constructor(e){super(e),this.fetchData=this.fetchData.bind(this),this.planColumns=this.planColumns.bind(this),this.renderEditableNumber=this.renderEditableNumber.bind(this),this.updateRowData=this.updateRowData.bind(this),this.addNewPlan=this.addNewPlan.bind(this),this.savePlan=this.savePlan.bind(this),this.state={dataUpToDate:null,url:this.props.url,datasource:[],products:[]}}updateRowData(e,t){const a=[...this.state.datasource];a[e.index][e.column.id]=t,this.setState({datasource:a})}renderEditableNumber(e){return s.a.createElement(h.d,{error:""==e.value,type:"number",min:0,fluid:!0,defaultValue:e.value||0,onChange:t=>{this.updateRowData(e,t.target.value)}})}fetchData(){let e=this.state.url;if(!e)return!1;fetch(e).then(e=>e.json()).then(e=>{if(e.status&&"error"==e.status)return console.warn(e.message),!1;let t={};e.plans&&(t.datasource=e.plans),e.products&&(t.products=e.products.map(e=>({key:e.product_id,value:e.product_id,text:e.name}))),this.setState(B({dataUpToDate:!0},t))}).catch(e=>{console.log("parsing failed",e)})}planColumns(){return H(1,52).map((e,t)=>({Header:`T${e}`,accessor:`w${e}`,maxWidth:100,Cell:this.renderEditableNumber}))}addNewPlan(){let e=B({plan_no:"",year:(new Date).getFullYear(),product_id:""},H(1,52).map(e=>{}));this.setState({datasource:this.state.datasource.concat(e)})}validDataBeforeSave(){let e=(e=>Object.keys(e).filter(t=>e[t]>1))((e=>e.reduce((e,t)=>Object.assign(e,{[t]:(e[t]||0)+1}),{}))(this.state.datasource.map(e=>`${e.year}_${e.product_id}`)));return!e.length||(alert("Có sản phẩm bị trùng kế hoạch: "+e[0]),!1)}savePlan(){if(!this.validDataBeforeSave())return!1;let e=this.state.datasource;fetch(ISD_BASE_URL+"updateplan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.data?alert("Đã cập nhật kế hoạch vào cơ sở dữ liệu!"):alert("Dữ liệu chưa được lưu vào hệ thống. Xin kiểm tra lại")}).catch(e=>{console.log("parsing failed",e)})}componentDidMount(){this.fetchData()}render(){let e=this.state.datasource;return s.a.createElement("div",{className:"ui segment order-add-form"},this.state.dataUpToDate?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"ui grid equal width"},s.a.createElement("div",{className:"column left aligned"},s.a.createElement("h2",{style:{textTransform:"uppercase"}},"Kế hoạch theo từng tuần trong năm")),s.a.createElement("div",{className:"column right aligned"},s.a.createElement("button",{onClick:()=>{this.addNewPlan()},type:"button",className:"ui button primary"},"Thêm kế hoạch"),s.a.createElement("button",{onClick:()=>{this.savePlan()},type:"button",className:"ui button teal"},"Lưu thay đổi"))),s.a.createElement(u.a,{getTdProps:(e,t,a,r)=>({onClick:(e,t)=>{t&&t()}}),columns:[{Header:"Thông tin kế hoạch",columns:[{Header:"Năm",accessor:"year",Cell:this.renderEditableNumber},{Header:"Sản phẩm",accessor:"product_id",minWidth:200,Cell:e=>s.a.createElement(h.b,{fluid:!0,selection:!0,style:{zIndex:100},search:!0,options:this.state.products,value:e.value,onChange:(t,a)=>{this.updateRowData(e,a.value)}})}]},{Header:"Kế hoạch từng tuần trong năm",columns:this.planColumns()}],data:e,filterable:!0,defaultPageSize:20,className:"-striped -highlight",style:{maxWidth:980}})):s.a.createElement(h.e,{active:!0,inline:!0,content:"Loading"}))}}var M=a(123),q=a(24),z=a(48),K=a(63),W=a(99),V=a(57),$=a(224),Q=a(227),J=a(226),X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};function G(e,t){var a={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a}const Y=K.a.Item,Z=s.a.createContext(),ee=K.a.create()(e=>{let t=e.form,a=(e.index,G(e,["form","index"]));return s.a.createElement(Z.Provider,{value:t},s.a.createElement("tr",a))});class te extends s.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"unit":return s.a.createElement(V.a,{placeholder:"Chọn đơn vị"},s.a.createElement(V.a.Option,{value:"Hộp"},"Hộp"),s.a.createElement(V.a.Option,{value:"Lọ"},"Lọ"),s.a.createElement(V.a.Option,{value:"Vỉ"},"Vỉ"),s.a.createElement(V.a.Option,{value:"Viên"},"Viên"));default:return s.a.createElement(M.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,r=e.dataIndex,n=e.title,i=(e.inputType,e.record),l=(e.index,G(e,["editing","required","dataIndex","title","inputType","record","index"]));return s.a.createElement(Z.Consumer,null,e=>{const o=e.getFieldDecorator;return s.a.createElement("td",l,t?s.a.createElement(Y,{style:{margin:0}},o(r,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${n}!`}],initialValue:i[r]})(this.getInput())):l.children)})}}var ae=class extends s.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(()=>{this.setState({editingKey:""})}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"product/deleteProduct/"+e.id,{headers:L()}).then(e=>e.json()).then(e=>{if("error"==e.status)q.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),q.a.success(e.message)}}).catch(e=>{q.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:""},this.columns=[{title:"Mã SP",dataIndex:"product_id",editable:!0,required:!0},{title:"Tên SP",dataIndex:"name",editable:!0,required:!0},{title:"Giá bán",dataIndex:"price",editable:!0,required:!0},{title:"Đơn vị",dataIndex:"unit",editable:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return s.a.createElement("div",{style:{minWidth:100}},a?s.a.createElement("span",null,s.a.createElement(Z.Consumer,null,e=>s.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),s.a.createElement(m.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},s.a.createElement("a",{href:"javascript:;"},"Huỷ"))):s.a.createElement(s.a.Fragment,null,s.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",s.a.createElement(m.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},s.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){let e=this.getDefaultFields();e=X({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key})}getDefaultFields(){return{id:"",product_id:"",name:"",price:0,unit:"Hộp"}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const r=[...this.state.data],s=r.findIndex(e=>t===e.key);if(s>-1){const e=r[s];let t=X({},e,a);fetch(ISD_BASE_URL+"product/updateProduct",{method:"POST",headers:L(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(q.a.error(e.message,3),e.show_login&&this.props.dispatch(d({showLogin:!0}))):(r.splice(s,1,X({},t,e.data)),this.setState({data:r,editingKey:""}),q.a.success(e.message))}).catch(e=>{console.log("parsing failed",e),q.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else r.push(data),this.setState({data:r,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"product/fetchProducts",{headers:L()}).then(e=>e.json()).then(e=>{if("error"==e.status)q.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>X({},e,{key:t}));this.setState({data:t})}}).catch(e=>{q.a.error("Có lỗi khi tải dữ liệu sản phẩm!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:ee,cell:te}},t=this.columns.map(e=>e.editable?X({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return s.a.createElement($.a,null,s.a.createElement("div",{className:"table-operations"},s.a.createElement(Q.a,null,s.a.createElement(W.a,{span:12},s.a.createElement("h2",{className:"head-title"},"Quản lý sản phẩm")),s.a.createElement(W.a,{span:12},s.a.createElement("div",{className:"action-btns"},s.a.createElement(z.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm Sản Phẩm"))))),s.a.createElement(J.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};function se(e,t){var a={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a}const ne=K.a.Item,ie=s.a.createContext(),le=K.a.create()(e=>{let t=e.form,a=(e.index,se(e,["form","index"]));return s.a.createElement(ie.Provider,{value:t},s.a.createElement("tr",a))});class oe extends s.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,s.a.createElement(M.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,r=e.dataIndex,n=e.title,i=(e.inputType,e.record),l=(e.index,se(e,["editing","required","dataIndex","title","inputType","record","index"]));return s.a.createElement(ie.Consumer,null,e=>{const o=e.getFieldDecorator;return s.a.createElement("td",l,t?s.a.createElement(ne,{style:{margin:0}},o(r,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${n}!`}],initialValue:i[r]})(this.getInput())):l.children)})}}var de=class extends s.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(()=>{this.setState({editingKey:""})}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"tdv/deleteTdv/"+e.id,{headers:L()}).then(e=>e.json()).then(e=>{if("error"==e.status)q.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),q.a.success(e.message)}}).catch(e=>{q.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:""},this.columns=[{title:"ID",dataIndex:"id",width:"10%",editable:!1,required:!0},{title:"Tên",dataIndex:"name",editable:!0,required:!0},{title:"Địa chỉ",dataIndex:"address",editable:!0,required:!0},{title:"Điện thoại",dataIndex:"phone",editable:!0},{title:"Công ty",dataIndex:"company",editable:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return s.a.createElement("div",{style:{minWidth:100}},a?s.a.createElement("span",null,s.a.createElement(ie.Consumer,null,e=>s.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),s.a.createElement(m.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},s.a.createElement("a",{href:"javascript:;"},"Huỷ"))):s.a.createElement(s.a.Fragment,null,s.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",s.a.createElement(m.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},s.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){let e=this.getDefaultFields();e=re({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key})}getDefaultFields(){return{id:"",name:"",address:"",phone:"",company:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const r=[...this.state.data],s=r.findIndex(e=>t===e.key);if(s>-1){const e=r[s];let t=re({},e,a);fetch(ISD_BASE_URL+"tdv/updateTdv",{method:"POST",headers:L(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(q.a.error(e.message,3),e.show_login&&this.props.dispatch(d({showLogin:!0}))):(r.splice(s,1,re({},t,e.data)),this.setState({data:r,editingKey:""}),q.a.success(e.message))}).catch(e=>{console.log("parsing failed",e),q.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else r.push(data),this.setState({data:r,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"tdv/fetchTdvs",{headers:L()}).then(e=>e.json()).then(e=>{if("error"==e.status)q.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>re({},e,{key:t}));this.setState({data:t})}}).catch(e=>{q.a.error("Có lỗi khi tải dữ liệu sản phẩm!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:le,cell:oe}},t=this.columns.map(e=>e.editable?re({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return s.a.createElement($.a,null,s.a.createElement("div",{className:"table-operations"},s.a.createElement(Q.a,null,s.a.createElement(W.a,{span:12},s.a.createElement("h2",{className:"head-title"},"Quản lý trình dược viên")),s.a.createElement(W.a,{span:12},s.a.createElement("div",{className:"action-btns"},s.a.createElement(z.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm TDV"))))),s.a.createElement(J.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};function he(e,t){var a={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a}const ue=K.a.Item,me=s.a.createContext(),pe=K.a.create()(e=>{let t=e.form,a=(e.index,he(e,["form","index"]));return s.a.createElement(me.Provider,{value:t},s.a.createElement("tr",a))});class ge extends s.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"product_id":let e=this.props.products;return s.a.createElement(V.a,{style:{width:150},placeholder:"Chọn đơn vị tính"},e.map(e=>s.a.createElement(V.a.Option,{key:e.product_id,value:e.product_id},e.name)));default:return s.a.createElement(M.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,r=e.dataIndex,n=e.title,i=(e.inputType,e.record),l=(e.index,he(e,["editing","required","dataIndex","title","inputType","record","index"]));return s.a.createElement(me.Consumer,null,e=>{const o=e.getFieldDecorator;return s.a.createElement("td",l,t?s.a.createElement(ue,{style:{margin:0}},o(r,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${n}!`}],initialValue:i[r]})(this.getInput())):l.children)})}}var fe=class extends s.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(()=>{this.setState({editingKey:""})}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"exchange/deleteExchange/"+e.id,{headers:L()}).then(e=>e.json()).then(e=>{if("error"==e.status)q.a.error("Có lỗi xảy ra khi xoá đơn vị tính!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),q.a.success(e.message)}}).catch(e=>{q.a.error("Có lỗi xảy ra khi xoá đơn vị tính!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:""},this.columns=[{title:"Mã SP",dataIndex:"product_id",editable:!0,required:!0},{title:"Dạng vỉ",dataIndex:"vi",editable:!0,required:!0},{title:"Dạng lọ",dataIndex:"lo",editable:!0,required:!0},{title:"Dạng siro",dataIndex:"siro",editable:!0,required:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return s.a.createElement("div",{style:{minWidth:100}},a?s.a.createElement("span",null,s.a.createElement(me.Consumer,null,e=>s.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),s.a.createElement(m.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},s.a.createElement("a",{href:"javascript:;"},"Huỷ"))):s.a.createElement(s.a.Fragment,null,s.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",s.a.createElement(m.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},s.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){let e=this.getDefaultFields();e=ce({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key})}getDefaultFields(){return{id:"",product_id:"",vi:"",lo:"",siro:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const r=[...this.state.data],s=r.findIndex(e=>t===e.key);if(s>-1){const e=r[s];let t=ce({},e,a);fetch(ISD_BASE_URL+"exchange/updateExchange",{method:"POST",headers:L(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(q.a.error(e.message,3),e.show_login&&this.props.dispatch(d({showLogin:!0}))):(r.splice(s,1,ce({},t,e.data)),this.setState({data:r,editingKey:""}),q.a.success(e.message))}).catch(e=>{console.log("parsing failed",e),q.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else r.push(data),this.setState({data:r,editingKey:""})})}fetchProduct(){fetch(ISD_BASE_URL+"product").then(e=>e.json()).then(e=>{e.data?this.props.dispatch(d({products:e.data})):q.a.error(e.message)}).catch(e=>{console.log(e)})}fetchData(){fetch(ISD_BASE_URL+"exchange/fetchExchange",{headers:L()}).then(e=>e.json()).then(e=>{if("error"==e.status)q.a.warning(e.message,3);else if(e.data){console.log(e.data);let t=e.data.map((e,t)=>ce({},e,{key:t}));this.setState({data:t})}}).catch(e=>{q.a.error("Có lỗi khi tải dữ liệu đơn vị tính!",3),console.log(e)})}componentDidMount(){this.fetchProduct(),this.fetchData()}render(){const e={body:{row:pe,cell:ge}};let t=this.props.mainState.products;const a=this.columns.map(e=>e.editable?ce({},e,{onCell:a=>({record:a,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(a),required:e.required,products:t})}):e);return s.a.createElement($.a,null,s.a.createElement("div",{className:"table-operations"},s.a.createElement(Q.a,null,s.a.createElement(W.a,{span:12},s.a.createElement("h2",{className:"head-title"},"Quản lý trình dược viên")),s.a.createElement(W.a,{span:12},s.a.createElement("div",{className:"action-btns"},s.a.createElement(z.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm mới"))))),s.a.createElement(J.a,{components:e,bordered:!0,dataSource:this.state.data,columns:a,rowClassName:"editable-row"}))}},ve=a(36),Ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};const ye=K.a.Item;var be=K.a.create()(class extends s.a.Component{constructor(...e){var t;return t=super(...e),this.state={loading:!1},this.handleSubmit=(e=>{e.preventDefault(),this.props.form.validateFields((e,t)=>{e||(this.setState({loading:!0}),this.getToken(Ee({},t)))})}),t}getToken(e){fetch(ISD_BASE_URL+"token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.token?(sessionStorage.setItem("ISD_TOKEN",e.token),this.props.dispatch(d({showLogin:!1,userRoles:e.scopes||[],userInfo:e.userInfo,defaultRouter:e.scopes[0]&&e.scopes[0].path?e.scopes[0].path:""}))):(q.a.error(e.message,5),this.setState({loading:!1}))}).catch(e=>{console.warn(e),q.a.error("Có lỗi trong quá trình đăng nhập!")})}render(){const e=this.props.form.getFieldDecorator;return s.a.createElement("div",{className:"login-wrapper"},s.a.createElement("div",{className:"login-logo"},s.a.createElement("img",{src:"./images/logo-pharma.png",alt:"Logo"})),s.a.createElement(K.a,{onSubmit:this.handleSubmit,className:"login-form"},s.a.createElement(ye,null,e("userName",{rules:[{required:!0,message:"Nhập tên đăng nhập!"}]})(s.a.createElement(M.a,{prefix:s.a.createElement(ve.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Tên đăng nhập"}))),s.a.createElement(ye,null,e("password",{rules:[{required:!0,message:"Nhập mật khẩu!"}]})(s.a.createElement(M.a,{prefix:s.a.createElement(ve.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Mật khẩu"}))),s.a.createElement(ye,null,s.a.createElement(z.a,{loading:this.state.loading,type:"primary",htmlType:"submit",className:"login-form-button"},"Đăng nhập"))))}});var Se=class extends s.a.Component{showUserName(){let e=this.props.mainState.userInfo;if(e)return e.name||e.username||e.email}render(){return s.a.createElement("div",{className:"admin-user-info"},s.a.createElement("div",{className:"user-info",style:{margin:10}},s.a.createElement("p",null,"Xin chào, "," ",s.a.createElement("b",null,this.showUserName()))),s.a.createElement("button",{onClick:()=>{this.props.dispatch(d({showLogin:!0}))},className:"ui button primary inverted teal"},"Đăng xuất"))}};var _e=Object(l.b)(e=>({mainState:e.main.present,uiState:e.ui}))(class extends r.Component{constructor(e){super(e),this.renderManagePage=this.renderManagePage.bind(this)}renderManagePage(){let e=this.props.mainState.pageId;var t=this.props;let a=t.dispatch,r=t.mainState;switch(e){case"stores":return s.a.createElement(E,{url:ISD_BASE_URL+"stores"});case"orders":return s.a.createElement(F,{url:ISD_BASE_URL+"orders"});case"plan":return s.a.createElement(U,{url:ISD_BASE_URL+"plan"});case"products":return s.a.createElement(ae,{url:ISD_BASE_URL+"products"});case"tdv":return s.a.createElement(de,{url:ISD_BASE_URL+"tdv"});case"exchange":return s.a.createElement(fe,{mainState:r,dispatch:a,url:ISD_BASE_URL+"exchange"});default:return s.a.createElement("h1",null,"Render ",e," page")}}componentWillMount(){let e=this.props.mainState;if(e.userInfo)this.props.dispatch(d({defaultRouter:e.defaultRouter}));else{let e=sessionStorage.getItem("ISD_TOKEN");""!=e&&null!=e&&fetch(ISD_BASE_URL+"fetchRoles",{headers:L()}).then(e=>e.json()).then(e=>{e.userInfo?this.props.dispatch(d({showLogin:!1,userRoles:e.scopes,defaultRouter:e.scopes[0]&&e.scopes[0].path?e.scopes[0].path:"",userInfo:e.userInfo})):"error"==e.status&&alert(e.message)}).catch(e=>{console.warn(e)})}}render(){var e=this.props.mainState;return e.pageId,e.showLogin?s.a.createElement(be,{dispatch:this.props.dispatch}):s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"grid-container"},s.a.createElement("div",{className:"header"},s.a.createElement("div",{className:"header_left"}),s.a.createElement("div",{className:"header_center"},s.a.createElement("h2",null,"QUẢN TRỊ KHÁCH HÀNG")),s.a.createElement("div",{className:"header_right"},s.a.createElement(Se,{dispatch:this.props.dispatch,mainState:this.props.mainState}))),s.a.createElement("div",{className:"menu menu_active"},s.a.createElement("a",{href:"#"},s.a.createElement("img",{width:"200",src:"images/logo-pharma.png"})),s.a.createElement(c,null)),s.a.createElement("div",{className:"isd_main"},s.a.createElement("div",{className:"main_content"},s.a.createElement("div",{className:"main_content_left active",page:"main"},s.a.createElement("div",{className:"list_infos"},this.renderManagePage()))))))}}),je=a(172),De=(a(477),a(215)),we=a.n(De),xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};let Ce,ke={pageId:window.ISD_CURRENT_PAGE?window.ISD_CURRENT_PAGE:"orders",showLogin:!0,products:[]};var Ie=a(427),Oe=a.n(Ie);let Te=[o.UPDATE_STATE_DATA];var Ne=Object(je.c)({main:Oe()((e=ke,t)=>{switch(t.type){case o.START_APP:return Ce=we()(e),Ce=xe({},Ce,t.defaultProps);case o.UPDATE_STATE_DATA:return Ce=we()(e),t.updateData&&t.updateData.showLogin&&sessionStorage.setItem("ISD_TOKEN",""),Ce=xe({},Ce,t.updateData)}return e},{filter:(e,t,a)=>-1!==Te.indexOf(e.type),limit:100})});const Re=Object(je.a)(),Pe=Object(je.d)(Ne,Re);Pe.close=(()=>Pe.dispatch(END));var Ae=Pe;const Le=document.getElementById("isd_app");i.a.render(s.a.createElement(l.a,{store:Ae},s.a.createElement(_e,null)),Le)},500:function(e,t,a){var r={"./af":357,"./af.js":357,"./ar":356,"./ar-dz":355,"./ar-dz.js":355,"./ar-kw":354,"./ar-kw.js":354,"./ar-ly":353,"./ar-ly.js":353,"./ar-ma":352,"./ar-ma.js":352,"./ar-sa":351,"./ar-sa.js":351,"./ar-tn":350,"./ar-tn.js":350,"./ar.js":356,"./az":349,"./az.js":349,"./be":348,"./be.js":348,"./bg":347,"./bg.js":347,"./bm":346,"./bm.js":346,"./bn":345,"./bn.js":345,"./bo":344,"./bo.js":344,"./br":343,"./br.js":343,"./bs":342,"./bs.js":342,"./ca":341,"./ca.js":341,"./cs":340,"./cs.js":340,"./cv":339,"./cv.js":339,"./cy":338,"./cy.js":338,"./da":337,"./da.js":337,"./de":336,"./de-at":335,"./de-at.js":335,"./de-ch":334,"./de-ch.js":334,"./de.js":336,"./dv":333,"./dv.js":333,"./el":332,"./el.js":332,"./en-au":331,"./en-au.js":331,"./en-ca":330,"./en-ca.js":330,"./en-gb":329,"./en-gb.js":329,"./en-ie":328,"./en-ie.js":328,"./en-il":327,"./en-il.js":327,"./en-nz":326,"./en-nz.js":326,"./eo":325,"./eo.js":325,"./es":324,"./es-do":323,"./es-do.js":323,"./es-us":322,"./es-us.js":322,"./es.js":324,"./et":321,"./et.js":321,"./eu":320,"./eu.js":320,"./fa":319,"./fa.js":319,"./fi":318,"./fi.js":318,"./fo":317,"./fo.js":317,"./fr":316,"./fr-ca":315,"./fr-ca.js":315,"./fr-ch":314,"./fr-ch.js":314,"./fr.js":316,"./fy":313,"./fy.js":313,"./gd":312,"./gd.js":312,"./gl":311,"./gl.js":311,"./gom-latn":310,"./gom-latn.js":310,"./gu":309,"./gu.js":309,"./he":308,"./he.js":308,"./hi":307,"./hi.js":307,"./hr":306,"./hr.js":306,"./hu":305,"./hu.js":305,"./hy-am":304,"./hy-am.js":304,"./id":303,"./id.js":303,"./is":302,"./is.js":302,"./it":301,"./it.js":301,"./ja":300,"./ja.js":300,"./jv":299,"./jv.js":299,"./ka":298,"./ka.js":298,"./kk":297,"./kk.js":297,"./km":296,"./km.js":296,"./kn":295,"./kn.js":295,"./ko":294,"./ko.js":294,"./ky":293,"./ky.js":293,"./lb":292,"./lb.js":292,"./lo":291,"./lo.js":291,"./lt":290,"./lt.js":290,"./lv":289,"./lv.js":289,"./me":288,"./me.js":288,"./mi":287,"./mi.js":287,"./mk":286,"./mk.js":286,"./ml":285,"./ml.js":285,"./mn":284,"./mn.js":284,"./mr":283,"./mr.js":283,"./ms":282,"./ms-my":281,"./ms-my.js":281,"./ms.js":282,"./mt":280,"./mt.js":280,"./my":279,"./my.js":279,"./nb":278,"./nb.js":278,"./ne":277,"./ne.js":277,"./nl":276,"./nl-be":275,"./nl-be.js":275,"./nl.js":276,"./nn":274,"./nn.js":274,"./pa-in":273,"./pa-in.js":273,"./pl":272,"./pl.js":272,"./pt":271,"./pt-br":270,"./pt-br.js":270,"./pt.js":271,"./ro":269,"./ro.js":269,"./ru":268,"./ru.js":268,"./sd":267,"./sd.js":267,"./se":266,"./se.js":266,"./si":265,"./si.js":265,"./sk":264,"./sk.js":264,"./sl":263,"./sl.js":263,"./sq":262,"./sq.js":262,"./sr":261,"./sr-cyrl":260,"./sr-cyrl.js":260,"./sr.js":261,"./ss":259,"./ss.js":259,"./sv":258,"./sv.js":258,"./sw":257,"./sw.js":257,"./ta":256,"./ta.js":256,"./te":255,"./te.js":255,"./tet":254,"./tet.js":254,"./tg":253,"./tg.js":253,"./th":252,"./th.js":252,"./tl-ph":251,"./tl-ph.js":251,"./tlh":250,"./tlh.js":250,"./tr":249,"./tr.js":249,"./tzl":248,"./tzl.js":248,"./tzm":247,"./tzm-latn":246,"./tzm-latn.js":246,"./tzm.js":247,"./ug-cn":245,"./ug-cn.js":245,"./uk":244,"./uk.js":244,"./ur":243,"./ur.js":243,"./uz":242,"./uz-latn":241,"./uz-latn.js":241,"./uz.js":242,"./vi":240,"./vi.js":240,"./x-pseudo":239,"./x-pseudo.js":239,"./yo":238,"./yo.js":238,"./zh-cn":237,"./zh-cn.js":237,"./zh-hk":236,"./zh-hk.js":236,"./zh-tw":235,"./zh-tw.js":235};function s(e){var t=n(e);return a(t)}function n(e){var t=r[e];if(!(t+1)){var a=new Error('Cannot find module "'+e+'".');throw a.code="MODULE_NOT_FOUND",a}return t}s.keys=function(){return Object.keys(r)},s.resolve=n,e.exports=s,s.id=500},716:function(e,t,a){e.exports=a(474)}});